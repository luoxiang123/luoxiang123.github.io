<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>罗翔的个人博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Hibernate总结一 Hibernate入门1. 什么是Hibernate?1234561. Hibernate是一个开放源代码的ORM框架:Object Relational Mapping对象关系映射    ORM:通过面向对象思想将java对象映射到数据库表中。而且通过操作java对象(访问set/get方法)来操作Hibernate数据库。不需要写任何的sql语句。     	示例：">
<meta property="og:type" content="article">
<meta property="og:title" content="罗翔的个人博客">
<meta property="og:url" content="http://yoursite.com/2017/11/27/Hibernate/index.html">
<meta property="og:site_name" content="罗翔的个人博客">
<meta property="og:description" content="Hibernate总结一 Hibernate入门1. 什么是Hibernate?1234561. Hibernate是一个开放源代码的ORM框架:Object Relational Mapping对象关系映射    ORM:通过面向对象思想将java对象映射到数据库表中。而且通过操作java对象(访问set/get方法)来操作Hibernate数据库。不需要写任何的sql语句。     	示例：">
<meta property="og:image" content="f:/老师代码/Stage3/Hibernate/day04-Criteria在线离线查询,Hibernate缓存及三种状态/Hibernate第四天下午/笔记/hibernate对象三种状态/Hibernate的对象三种状态状态转化图.bmp">
<meta property="og:updated_time" content="2017-12-02T01:40:24.893Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="罗翔的个人博客">
<meta name="twitter:description" content="Hibernate总结一 Hibernate入门1. 什么是Hibernate?1234561. Hibernate是一个开放源代码的ORM框架:Object Relational Mapping对象关系映射    ORM:通过面向对象思想将java对象映射到数据库表中。而且通过操作java对象(访问set/get方法)来操作Hibernate数据库。不需要写任何的sql语句。     	示例：">
<meta name="twitter:image" content="f:/老师代码/Stage3/Hibernate/day04-Criteria在线离线查询,Hibernate缓存及三种状态/Hibernate第四天下午/笔记/hibernate对象三种状态/Hibernate的对象三种状态状态转化图.bmp">
  
    <link rel="alternate" href="/atom.xml" title="罗翔的个人博客" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">罗翔的个人博客</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Suche"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-Hibernate" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/11/27/Hibernate/" class="article-date">
  <time datetime="2017-11-27T00:56:28.148Z" itemprop="datePublished">2017-11-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Hibernate总结"><a href="#Hibernate总结" class="headerlink" title="Hibernate总结"></a>Hibernate总结</h1><h2 id="一-Hibernate入门"><a href="#一-Hibernate入门" class="headerlink" title="一 Hibernate入门"></a>一 Hibernate入门</h2><h3 id="1-什么是Hibernate"><a href="#1-什么是Hibernate" class="headerlink" title="1. 什么是Hibernate?"></a>1. 什么是Hibernate?</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1. Hibernate是一个开放源代码的ORM框架:Object Relational Mapping对象关系映射    </span><br><span class="line">ORM:通过面向对象思想将java对象映射到数据库表中。而且通过操作java对象(访问set/get方法)来操作Hibernate数据库。不需要写任何的sql语句。     </span><br><span class="line">	示例：  </span><br><span class="line">   java对象-----------映射过程Hibernate完成-----------------数据库    </span><br><span class="line">   私有成员变量  -----------映射过程Hibernate完成------------ 表中的字段(列名)  	    提供公共的set/get方法------映射过程Hibernate完成----------- 操作表中的字段(列名)</span><br><span class="line">2.Hibernate封装了jdbc的所有操作，可以应用到任何使用JDBC的场合，即可以在java客户端程序使用，也可以在web程序中的servlet/jsp中使用</span><br></pre></td></tr></table></figure>
<h3 id="2-Hibernate特点？"><a href="#2-Hibernate特点？" class="headerlink" title="2. Hibernate特点？"></a>2. Hibernate特点？</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">1.基于面向对象思想的，不需要写sql语句</span><br><span class="line">2.高性能(延迟加载策略，抓取策略等。。。。)</span><br><span class="line">3.scalability 可伸缩性</span><br><span class="line">4.可靠性强(稳定性)</span><br><span class="line">5.可拓展性</span><br><span class="line">6.数据库平台移植性好。(通过配置可以使用不同的数据库平台)</span><br><span class="line">7.hibernate开源免费，适合大中型系统</span><br><span class="line"></span><br><span class="line">缺点：</span><br><span class="line">   1.不是批量操作</span><br><span class="line">   2.效率比jdbc略差。</span><br></pre></td></tr></table></figure>
<h3 id="3-下载Hibernate的库"><a href="#3-下载Hibernate的库" class="headerlink" title="3. 下载Hibernate的库"></a>3. 下载Hibernate的库</h3><p><a href="http://hibernate.org/orm/releases/5.2/" target="_blank" rel="noopener">http://hibernate.org/orm/releases/5.2/</a></p>
<h3 id="4-入门程序"><a href="#4-入门程序" class="headerlink" title="4. 入门程序"></a>4. 入门程序</h3><h4 id="4-1-准备工作"><a href="#4-1-准备工作" class="headerlink" title="4.1 准备工作"></a>4.1 准备工作</h4><p>Hibernate5.2及后续版本      使用JDK1.8以上包含1.8</p>
<p>Hibernate 5.1及后续版本     使用jdk1.6以上</p>
<h4 id="4-2-入门程序"><a href="#4-2-入门程序" class="headerlink" title="4.2 入门程序"></a>4.2 入门程序</h4><h5 id="4-2-1-创建web-project-工程"><a href="#4-2-1-创建web-project-工程" class="headerlink" title="4.2.1 创建web project 工程"></a>4.2.1 创建web project 工程</h5><h5 id="4-2-2-添加jar包-11个"><a href="#4-2-2-添加jar包-11个" class="headerlink" title="4.2.2 添加jar包(11个)"></a>4.2.2 添加jar包(11个)</h5><p>​        hibernate(10个：下载库的lib/required/xx)  +  mysql驱动</p>
<h5 id="4-2-3-写一个持久化Student类"><a href="#4-2-3-写一个持久化Student类" class="headerlink" title="4.2.3 写一个持久化Student类"></a>4.2.3 写一个持久化Student类</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 持久化类(pojo类:一个简单的java对象   plain ordinary  java object  )</span></span><br><span class="line"><span class="comment">书写原则：</span></span><br><span class="line"><span class="comment"> * 1.必须有无参构造方法</span></span><br><span class="line"><span class="comment"> * 2.成员变量必须是private的</span></span><br><span class="line"><span class="comment"> * 3.属性方法(set/get)是public</span></span><br><span class="line"><span class="comment"> * 4.成员变量的类型尽量使用包装类型(包装类具有对象的属性和方法，可以方便的去操作基本类型)</span></span><br><span class="line"><span class="comment"> * 5.必须要有一个oid(Object  InDetitifer  唯一标识)与表的主键对应</span></span><br><span class="line"><span class="comment"> * 6.该类不能用final修饰(final修饰的变量不可改变,final修饰的方法不可重写, final修饰的类不可继承)</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> 备注： Hibernate中延迟加载的机制用到了动态代理模式，动态代理中的类很可能要被继承。</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>
<h5 id="4-2-4-元数据配置文件"><a href="#4-2-4-元数据配置文件" class="headerlink" title="4.2.4 元数据配置文件"></a>4.2.4 元数据配置文件</h5><p>​    持久化类的映射文件</p>
<p>​      备注： 文件名称：  持久化类名称.hbm.xml   和持久化类必须在同一个目录下</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br><span class="line"><span class="comment">&lt;!-- 查找映射文件的xml约束规则：</span></span><br><span class="line"><span class="comment">     hibernate-core.xx.jar中查找:org.hibernate包hibernate-mapping-3.0.dtd--&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE hibernate-mapping PUBLIC </span></span><br><span class="line"><span class="meta">    "-//Hibernate/Hibernate Mapping DTD 3.0//EN"</span></span><br><span class="line"><span class="meta">    "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd"&gt;</span>    </span><br><span class="line"><span class="comment">&lt;!--hibernate映射的说明 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">hibernate-mapping</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- class：告诉hibernate要映射的是那个类 </span></span><br><span class="line"><span class="comment">       name：指明具体的类， table：表示指定类要映射到数据库中的表名--&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"com.qf.domain.Student"</span> <span class="attr">table</span>=<span class="string">"stu"</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- id表示主键，唯一标识，name是持久化类中的主键名，column：表中的主键名 --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"stu_id"</span> <span class="attr">column</span>=<span class="string">"stu_id"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 主键的生成策略 native根据数据库平台决定主键如何运行，mysql：主键肯定是唯一，不为空，自动增长 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"native"</span>&gt;</span><span class="tag">&lt;/<span class="name">generator</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">     <span class="comment">&lt;!-- 普通的成员变量映射到数据库表中作为普通的列 --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"stu_name"</span> <span class="attr">column</span>=<span class="string">"stu_name"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"stu_birthday"</span> <span class="attr">column</span>=<span class="string">"stu_birthday"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">hibernate-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="4-2-5-主配置文件"><a href="#4-2-5-主配置文件" class="headerlink" title="4.2.5 主配置文件"></a>4.2.5 主配置文件</h5><p>​     4(数据库连接信息)+1(数据库方言)+2(显示数据库)+1(数据库生成策略)+1(加载映射文件)</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br><span class="line"><span class="comment">&lt;!-- 加载并启动初始化hibernate框架： 约束规则：</span></span><br><span class="line"><span class="comment">   hibernate-core.xx.jar/org.hibernate/hibernate-configuration-3.0.dtd --&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE hibernate-configuration PUBLIC</span></span><br><span class="line"><span class="meta">	"-//Hibernate/Hibernate Configuration DTD 3.0//EN"</span></span><br><span class="line"><span class="meta">	"http://www.hibernate.org/dtd/hibernate-configuration-3.0.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">hibernate-configuration</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">session-factory</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 以下配置的依据查找：下载的库project\etc\hibernate.properties中查找 --&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 1. 配置连接数据库的信息：驱动，地址，用户名，密码 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.driver_class"</span>&gt;</span></span><br><span class="line">               com.mysql.jdbc.Driver</span><br><span class="line">         <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.url"</span>&gt;</span></span><br><span class="line">              jdbc:mysql://localhost:3306/1715_hibernate01</span><br><span class="line">         <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.username"</span>&gt;</span>root<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.password"</span>&gt;</span>123456<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		</span><br><span class="line">        <span class="comment">&lt;!--2. 配置数据库的方言 mysql5.0之后的方言  org.hibernate.dialect.MySQL5InnoDBDialect</span></span><br><span class="line"><span class="comment">           表示创建表的类型是：  engine=InnoDB --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.dialect"</span>&gt;</span></span><br><span class="line">         org.hibernate.dialect.MySQL5InnoDBDialect</span><br><span class="line">      <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">       </span><br><span class="line">         <span class="comment">&lt;!--3.配置在后台显示hibernate生成的sql语句(过程)--&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.show_sql"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.format_sql"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">         <span class="comment">&lt;!--4.配置数据库生成的策略(4个)  --&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.hbm2ddl.auto"</span>&gt;</span>update<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">         <span class="comment">&lt;!--5. 加载持久化类的映射文件： resource: src下资源目录--&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">mapping</span>  <span class="attr">resource</span>=<span class="string">"com/qf/domain/Student.hbm.xml"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">session-factory</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">hibernate-configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="4-2-6-创建测试类测试"><a href="#4-2-6-创建测试类测试" class="headerlink" title="4.2.6 创建测试类测试"></a>4.2.6 创建测试类测试</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.qf.test;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.Session;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.SessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.cfg.Configuration;</span><br><span class="line"><span class="keyword">import</span> com.qf.domain.Student;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestHibernate01</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">	<span class="comment">//1.加载主配置文件Hibernate.cfg.xml(主配置文件又加载了映射文件(元数据配置文件))</span></span><br><span class="line">		<span class="comment">//1.1 创建配置类的对象</span></span><br><span class="line">		Configuration configuration =<span class="keyword">new</span> Configuration();</span><br><span class="line">		<span class="comment">//1.2 加载配置文件(加载hibernate.cfg.xml文件)</span></span><br><span class="line">		configuration.configure();	</span><br><span class="line">		<span class="comment">//2.从配置文件中得到sessionFactory对象</span></span><br><span class="line">		SessionFactory factory = configuration.buildSessionFactory();</span><br><span class="line">		<span class="comment">//3.工厂生成session(Hibernate中的session)</span></span><br><span class="line">		Session session = factory.openSession();</span><br><span class="line">		<span class="comment">//4.session可以增删查改</span></span><br><span class="line">		Student student =<span class="keyword">new</span> Student();</span><br><span class="line">		student.setStu_name(<span class="string">"皮皮虾"</span>);</span><br><span class="line">		student.setStu_birthday( <span class="keyword">new</span> Date());</span><br><span class="line">		</span><br><span class="line">         session.save(student);	</span><br><span class="line">		<span class="comment">//关闭资源</span></span><br><span class="line">		session.close();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="5-Hibernate中使用的核心类api解释"><a href="#5-Hibernate中使用的核心类api解释" class="headerlink" title="5. Hibernate中使用的核心类api解释"></a>5. Hibernate中使用的核心类api解释</h3><ol>
<li>Configuration</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Configuration: 配置Hibernate且启动初始化Hibernate框架。</span><br><span class="line">示例：</span><br><span class="line">Configuration  c =<span class="keyword">new</span> Configuration();</span><br><span class="line">c.configure(); <span class="comment">//加载src下的hibernate.cfg.xml文件</span></span><br></pre></td></tr></table></figure>
<ol>
<li>SessionFactory</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">从配置中得到SessionFactory对象，生产Session对象：</span><br><span class="line"> c.buildSessionFactory();</span><br><span class="line"> 备注：SessionFacotry不是轻量级的。一个数据库对应一个SessionFactory对象。</span><br><span class="line">     如果一个程序有多个数据库一定要有多个SessionFactory对象。</span><br><span class="line">     SessionFactory线程安全的。</span><br></pre></td></tr></table></figure>
<ol>
<li>Session</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Session负责增删改查。Session是非线程安全的。此处的Session指的是Hibernate的session(不同于HttpSession,唯一标识用户，用户session)</span><br><span class="line">factory.openSession()</span><br><span class="line">备注：Session使用结束需要关闭。</span><br></pre></td></tr></table></figure>
<ol>
<li>Query</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">负责查询，本地SQL语句查询和HQL查询。</span><br></pre></td></tr></table></figure>
<ol>
<li>Transaction</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">事务操作。</span><br></pre></td></tr></table></figure>
<ol>
<li>Criteria</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">查询(在线查询和离线查询)</span><br></pre></td></tr></table></figure>
<h3 id="6-主键生成策略"><a href="#6-主键生成策略" class="headerlink" title="6. 主键生成策略"></a>6. 主键生成策略</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 当不指定table的时候表名就是持久化类的名称 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!--如果没有指明column属性，表中的列名就是持久化类中成员变量的名称  --&gt;</span></span><br><span class="line">示例：</span><br><span class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br><span class="line"><span class="comment">&lt;!-- 查找映射文件的xml约束规则： hibernate-core.xx.jar中查找:org.hibernate包hibernate-mapping-3.0.dtd --&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE hibernate-mapping PUBLIC </span></span><br><span class="line"><span class="meta">    "-//Hibernate/Hibernate Mapping DTD 3.0//EN"</span></span><br><span class="line"><span class="meta">    "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd"&gt;</span></span><br><span class="line"><span class="comment">&lt;!--hibernate映射的说明 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">hibernate-mapping</span> <span class="attr">package</span>=<span class="string">"com.qf.domain"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 当不指定table的时候表名就是持久化类的名称 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"Student2"</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--如果没有指明column属性，表中的列名就是持久化类中成员变量的名称  --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"stu_id"</span>&gt;</span>      </span><br><span class="line">			<span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"uuid"</span>&gt;</span><span class="tag">&lt;/<span class="name">generator</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"stu_name"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"stu_birthday"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">hibernate-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>主键的分类</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">1.自然主键    开发者自己维护主键</span><br><span class="line">     表中有一个列，不为空，不重复，而且不能随意修改，当作主键使用。</span><br><span class="line">     需要用户手动插入主键值(主键由开发者来维护，hibernate不维护) </span><br><span class="line">     特点：业务逻辑复杂的时候，数据库的维护难度增加，不推荐。</span><br><span class="line">     </span><br><span class="line">     assigned:必须自己手动插入主键值，不插入报异常。</span><br><span class="line">2.代理主键  hibernate维护主键</span><br><span class="line">     表中没有符合主键的列，创建一个列作为主键，且该键在业务处理中不具有任何意义(只是用来标识数据)。</span><br><span class="line">     特点：显然代理主键</span><br><span class="line">     常见代理主键如下： </span><br><span class="line">    native：本地策略。数据库平台不同。自动选择指定数据的策略。</span><br><span class="line">            例如：mysql数据默认选择的是identity</span><br><span class="line">                  orcale数据库默认选择的是sequence</span><br><span class="line">    increment:适用于int,long,short类型的主键。自动增长机制是：</span><br><span class="line">              1.先查询数据库中最大的id值 select  max(id) from stu;</span><br><span class="line">              2.在最大的id值上加1作为新的id值插入 </span><br><span class="line">    identity:只能用在支持自动增长的数据中使用。如mysql支持自动增长，orcale不支持自动增长。</span><br><span class="line">    uuid:适用于char,varchar类型的主键。长度为32位的16进制的字符串。占空间大。</span><br><span class="line">         效率高保证唯一性，数据库移植性更好。</span><br><span class="line">    sequence:oralce数据库使用的策略。 </span><br><span class="line">    </span><br><span class="line">备注：hibernate所有操作加事务</span><br><span class="line">开启事务</span><br><span class="line">Transaction t = session.beginTransaction();</span><br><span class="line">    try&#123;</span><br><span class="line">      //做自己的事</span><br><span class="line">      提交事务</span><br><span class="line">      t.commit();</span><br><span class="line">    &#125;catch(Exception e)&#123;</span><br><span class="line">      事务回滚(异常的时候)</span><br><span class="line">      if(t!=null)&#123;</span><br><span class="line">         t.rollback();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h3 id="7-数据库生成策略"><a href="#7-数据库生成策略" class="headerlink" title="7. 数据库生成策略"></a>7. 数据库生成策略</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--配置数据库生成的策略</span></span><br><span class="line"><span class="comment">             create:先删除表后创建表，再操作</span></span><br><span class="line"><span class="comment">             create-drop:先判断有就删除，没有就创建，但是使用完该表删除。(关掉sessionFactory)</span></span><br><span class="line"><span class="comment">             update:没有表就创建表,如果有表了直接进行数据库操作(插入，删除，修改，查询)</span></span><br><span class="line"><span class="comment">             validate:校验。不会自动创建表。主要是校验持久化类中的变量和数据库表的列名是否一致。</span></span><br><span class="line"><span class="comment">             </span></span><br><span class="line"><span class="comment">                    正式运行的项目使用update.</span></span><br><span class="line"><span class="comment">                    测试：create-drop</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="二-Hibernate增删改查"><a href="#二-Hibernate增删改查" class="headerlink" title="二 Hibernate增删改查"></a>二 Hibernate增删改查</h2><h3 id="1-Hibernate中的事务"><a href="#1-Hibernate中的事务" class="headerlink" title="1. Hibernate中的事务"></a>1. Hibernate中的事务</h3><h4 id="1-1-设置事务隔离级别"><a href="#1-1-设置事务隔离级别" class="headerlink" title="1.1 设置事务隔离级别"></a>1.1 设置事务隔离级别</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Hibernate中事务的隔离级别都是用字节存储的</span><br><span class="line">                           二进制      十进制</span><br><span class="line">read uncommitted  读未提交   0001        1</span><br><span class="line">read committed  读已提交     0010        2</span><br><span class="line">repeatable read  重复读      0100        4    mysql默认级别</span><br><span class="line">serializable 可串行化        1000        8</span><br><span class="line"></span><br><span class="line">配置数据库的隔离级别直接写十进制的值即可</span><br><span class="line">在主配置文件(hibernate.cfg.xml)中配置数据库的隔离级别</span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.isolation"</span>&gt;</span>4<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="1-2-Hibernate管理事务的方法"><a href="#1-2-Hibernate管理事务的方法" class="headerlink" title="1.2 Hibernate管理事务的方法"></a>1.2 Hibernate管理事务的方法</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//开启事务：</span></span><br><span class="line">   Transcation t=  session.beginTranscation();</span><br><span class="line">   <span class="keyword">try</span>&#123;</span><br><span class="line">     <span class="comment">//........写自己的代码(do som work....)</span></span><br><span class="line">     <span class="comment">//提交事务：</span></span><br><span class="line">     t.commit();</span><br><span class="line">   &#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">     <span class="comment">//异常后：回滚事务</span></span><br><span class="line">     <span class="keyword">if</span>(t!=<span class="keyword">null</span>)&#123;</span><br><span class="line">        t.rollback();</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-Hibernate得到Session对象的方式"><a href="#2-Hibernate得到Session对象的方式" class="headerlink" title="2. Hibernate得到Session对象的方式"></a>2. Hibernate得到Session对象的方式</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Configuration c= <span class="keyword">new</span> Configuration();</span><br><span class="line">c.Configure();<span class="comment">//读hibernate.cfg.xml文件</span></span><br><span class="line">SessionFactory factory= c.buildSessionFactory();</span><br><span class="line">方式一：</span><br><span class="line">factory.openSession();<span class="comment">//线程不安全的</span></span><br><span class="line">方式二：</span><br><span class="line">factory.getCurrentSession();<span class="comment">//线程安全的</span></span><br><span class="line">注意：要理解getCurrentSesssion(),原理跟以前ThreadLocal&lt;Connection&gt;一样。</span><br></pre></td></tr></table></figure>
<h3 id="3-openSession-和getCurrentSession-区别-重点"><a href="#3-openSession-和getCurrentSession-区别-重点" class="headerlink" title="3. openSession()和getCurrentSession()区别(重点)"></a>3. openSession()和getCurrentSession()区别(重点)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*   </span></span><br><span class="line"><span class="comment">* openSession()和getCurrentSession()   </span></span><br><span class="line"><span class="comment">* </span></span><br><span class="line"><span class="comment">* 1.openSession()每次调用生成新的Session</span></span><br><span class="line"><span class="comment">*   getCurrentSession()每次调用都使用的同一个session(与当前线程绑定的session)</span></span><br><span class="line"><span class="comment">*  </span></span><br><span class="line"><span class="comment">* 2.openSession()使用不需要配置</span></span><br><span class="line"><span class="comment">*   getCurrentSession()必须要配置，在主配置文件hibernate.cfg.xml中配置</span></span><br><span class="line"><span class="comment">*   &lt;property name="hibernate.current_session_context_class"&gt;thread&lt;/property&gt;</span></span><br><span class="line"><span class="comment">* 3. openSession()使用之后可以关闭  </span></span><br><span class="line"><span class="comment">*    getCurrentSession()不能关闭</span></span><br><span class="line"><span class="comment">* </span></span><br><span class="line"><span class="comment">* 4.Session要线程安全建议使用getCurrentSession();  </span></span><br><span class="line"><span class="comment">* </span></span><br><span class="line"><span class="comment">* 建议用getCurrentSession()</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<h3 id="4-HibernateUtils封装的工具类"><a href="#4-HibernateUtils封装的工具类" class="headerlink" title="4. HibernateUtils封装的工具类"></a>4. HibernateUtils封装的工具类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.qf.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.hibernate.Session;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.SessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.cfg.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HibernateUtils</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> SessionFactory sessionFactory=<span class="keyword">null</span>;</span><br><span class="line">	<span class="keyword">static</span> &#123;</span><br><span class="line">		Configuration configuration = <span class="keyword">new</span> Configuration();</span><br><span class="line">		configuration.configure();</span><br><span class="line">		sessionFactory = configuration.buildSessionFactory();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Session <span class="title">openSession</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> sessionFactory.openSession();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Session <span class="title">getCurrentSession</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> sessionFactory.getCurrentSession();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//openSession产生的session要关闭</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">closeSession</span><span class="params">(Session session)</span> </span>&#123;</span><br><span class="line">		  session.close();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="5-Hibernate增删改"><a href="#5-Hibernate增删改" class="headerlink" title="5. Hibernate增删改"></a>5. Hibernate增删改</h3><h4 id="5-1-增-插入"><a href="#5-1-增-插入" class="headerlink" title="5.1 增(插入)"></a>5.1 增(插入)</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//参数1：实体类名称</span></span><br><span class="line">session.save(<span class="string">"User"</span>, user);</span><br></pre></td></tr></table></figure>
<h4 id="5-2-删除"><a href="#5-2-删除" class="headerlink" title="5.2 删除"></a>5.2 删除</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//根据唯一标识(主键)来删除</span></span><br><span class="line">session.delete(user);</span><br></pre></td></tr></table></figure>
<h4 id="5-3-改-更新"><a href="#5-3-改-更新" class="headerlink" title="5.3 改(更新)"></a>5.3 改(更新)</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//根据唯一标识(主键)来修改</span></span><br><span class="line">方式一:</span><br><span class="line">User user=<span class="keyword">new</span> User();</span><br><span class="line">user.setUser_id(<span class="number">1</span>);</span><br><span class="line">user.setUser_name(<span class="string">"看谁在睡觉？"</span>);</span><br><span class="line">session.update(user);<span class="comment">//这种方式，未set属性值的属性,更新数据库的时候，数据库会默认为Null,所以一般推荐使用第二种方式更新</span></span><br><span class="line"></span><br><span class="line">方式二:</span><br><span class="line">User user=session.get(<span class="string">"User.class"</span>,<span class="number">1</span>);<span class="comment">//根据主键id获取User对象</span></span><br><span class="line">user.setUser_name(<span class="string">"看谁在睡觉？"</span>);</span><br><span class="line">session.update(user);<span class="comment">//这种方式，不想更新的属性值不会变</span></span><br><span class="line"></span><br><span class="line">方式三：</span><br><span class="line"><span class="comment">//根据唯一标识(主键)来修改</span></span><br><span class="line">User user =<span class="keyword">new</span> User();</span><br><span class="line">user.setUser_id(<span class="number">1</span>);</span><br><span class="line">user.setUser_name(<span class="string">"吃饭睡觉"</span>);</span><br><span class="line">user.setUser_pwd(<span class="string">"1234564546"</span>);</span><br><span class="line"><span class="comment">//saveOrUpdate()根据唯一标识主键id决定是save还是update()</span></span><br><span class="line"><span class="comment">//能根据id查找到直接update</span></span><br><span class="line"><span class="comment">//没有id执行 save.</span></span><br><span class="line"><span class="comment">//如果设置了id，但是id在数据库中找不到，后台打印的是update，但是数据库中中插入了该数据</span></span><br><span class="line">session.saveOrUpdate(user);</span><br></pre></td></tr></table></figure>
<h4 id="5-4-查询"><a href="#5-4-查询" class="headerlink" title="5.4 查询"></a>5.4 查询</h4><h5 id="5-4-1-第一种方式：OID"><a href="#5-4-1-第一种方式：OID" class="headerlink" title="5.4.1 第一种方式：OID"></a>5.4.1 第一种方式：OID</h5><p> 以oid(唯一标识)的形式进行查询(只能查询单条数据)：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//参数1：查询的类型：T.class 参数2：唯一标识id值</span><br><span class="line"> session.find(T.class,id);</span><br><span class="line"> session.get(T.class,id);</span><br><span class="line"> session.load(T.class,id);</span><br></pre></td></tr></table></figure>
<h5 id="5-4-2-第二种方式：对象导航图查询"><a href="#5-4-2-第二种方式：对象导航图查询" class="headerlink" title="5.4.2 第二种方式：对象导航图查询"></a>5.4.2 第二种方式：对象导航图查询</h5><p>   (常用于多表查询)</p>
<h5 id="5-4-3-第三种方式：原生sql语句查询"><a href="#5-4-3-第三种方式：原生sql语句查询" class="headerlink" title="5.4.3 第三种方式：原生sql语句查询"></a>5.4.3 第三种方式：原生sql语句查询</h5><p>SQL(结构化查询语言 Structor Query Language)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Hibernate5.2以后用 session.createNativeQuery(sql语句);</span><br><span class="line">Hibernate5.2以前用session.createSQLQuery(sql语句);</span><br></pre></td></tr></table></figure>
<p>原生sql的顺序及所有关键字及常见语句(mysql)：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">sql语句的书写顺序： </span><br><span class="line"> select * from 表名</span><br><span class="line">              where  条件</span><br><span class="line">              group by 列名</span><br><span class="line">              having  条件</span><br><span class="line">              order by  列名 asc/desc</span><br><span class="line">              limit start,size	</span><br><span class="line"> <span class="number">1</span>.having和where比较</span><br><span class="line">      where 在分组前过滤,</span><br><span class="line">      having在分组后过滤,可以加聚合函数(max,min,sum.count.avg)，不能独立出现，必须分组后调用</span><br><span class="line"> <span class="number">2</span>.sql执行顺序：  </span><br><span class="line">      from 表名</span><br><span class="line">      where 条件</span><br><span class="line">      group by 列名</span><br><span class="line">      having  条件</span><br><span class="line">      order by  列名 asc/desc</span><br><span class="line">      limit start,size	   </span><br><span class="line">      select</span><br><span class="line"> <span class="number">3</span>.模糊查询 like  %代表任意字符  _代表一个字符   ，如果like后的值是字符串一定要用单引号</span><br></pre></td></tr></table></figure>
<h5 id="5-4-4-第四种方式：HQL查询-Hibernate-Query-Language-重点"><a href="#5-4-4-第四种方式：HQL查询-Hibernate-Query-Language-重点" class="headerlink" title="5.4.4 第四种方式：HQL查询(Hibernate  Query Language) (重点)"></a>5.4.4 第四种方式：HQL查询(Hibernate  Query Language) (重点)</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">基于面向对象思想来查询。查询的是对象和对象的属性.关键字不区分大小写。类和属性等区分大小写</span><br><span class="line">以下方法获取多条数据：</span><br><span class="line"> query.list()  query.getResultList()</span><br><span class="line"> 以下方法获取单条数据：</span><br><span class="line"> query.uniqueResult()</span><br></pre></td></tr></table></figure>
<h6 id="5-4-4-1-基础查询"><a href="#5-4-4-1-基础查询" class="headerlink" title="5.4.4.1 基础查询"></a>5.4.4.1 基础查询</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//基本语法：from  包名+类名(如果整个程序中只有这么一个类，直接省略包名，默认查找该类)</span></span><br><span class="line">String HQL=<span class="string">"from com.qf.domain.User"</span>;</span><br><span class="line">Query&lt;User&gt; query = session.createQuery(HQL, User.class);</span><br><span class="line">List&lt;User&gt; list = query.list();</span><br></pre></td></tr></table></figure>
<h6 id="5-4-4-2-别名查询"><a href="#5-4-4-2-别名查询" class="headerlink" title="5.4.4.2 别名查询"></a>5.4.4.2 别名查询</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//s是User类的别名，查询User类中的所有内容。select User类中的所有成员变量 from User</span></span><br><span class="line"><span class="comment">//简化版：select s from User s  s代表整个User类，查询User类的所有</span></span><br><span class="line">String HQL=<span class="string">"select s from User s"</span>;</span><br><span class="line">Query&lt;User&gt; query = session.createQuery(HQL, User.class);</span><br><span class="line">List&lt;User&gt; list = query.list();</span><br></pre></td></tr></table></figure>
<h6 id="5-4-4-3-条件查询"><a href="#5-4-4-3-条件查询" class="headerlink" title="5.4.4.3 条件查询"></a>5.4.4.3 条件查询</h6><p>   方式一：?号占位，使用setParameter(position, value)赋值,位置从0开始</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">String HQL=<span class="string">"from com.qf.domain.User where user_id =? "</span>;</span><br><span class="line">Query&lt;User&gt; query = session.createQuery(HQL, User.class);</span><br><span class="line"><span class="comment">//参数1：?号的位置，从0开始</span></span><br><span class="line"><span class="comment">//参数2：value赋值</span></span><br><span class="line">query.setParameter(<span class="number">0</span>, <span class="number">2</span>);</span><br><span class="line">System.out.println(query.uniqueResult());<span class="comment">//获取单条数据</span></span><br></pre></td></tr></table></figure>
<p>  方式二：属性名称占位，使用setParameter(name,value)赋值</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//:user_id表示占位</span></span><br><span class="line">String HQL=<span class="string">"from com.qf.domain.User where user_id=:user_id"</span>;</span><br><span class="line">Query&lt;User&gt; query = session.createQuery(HQL, User.class);</span><br><span class="line"><span class="comment">//参数1：表示属性名 ，参数2：属性名对应的值</span></span><br><span class="line">query.setParameter(<span class="string">"user_id"</span>, <span class="number">2</span>);</span><br></pre></td></tr></table></figure>
<h5 id="5-4-5-第五种方式：QBC查询-Query-By-Criteria"><a href="#5-4-5-第五种方式：QBC查询-Query-By-Criteria" class="headerlink" title="5.4.5 第五种方式：QBC查询(Query By Criteria)"></a>5.4.5 第五种方式：QBC查询(Query By Criteria)</h5><p>QBC:Query  By Criteria     标准查询     JPA中Criteria<br>SQL、HQL 或者各种关键字的语句都不需要书写。全部用方法代替。<br> Hibernate5.2之前 session.createCriteria(XX);<br> Hibernate5.2之后 建造者模式(重点)</p>
<h6 id="5-4-5-1-基础查询"><a href="#5-4-5-1-基础查询" class="headerlink" title="5.4.5.1 基础查询"></a>5.4.5.1 基础查询</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.创建CriteriaBuilder对象，用于构建查询条件</span></span><br><span class="line">CriteriaBuilder cBuilder= session.getCriteriaBuilder();</span><br><span class="line"><span class="comment">//2.构建Criteria查询对象同时要声明返回的结果类型：Person</span></span><br><span class="line">CriteriaQuery&lt;Person&gt; cQuery= cBuilder.createQuery(Person.class);</span><br><span class="line"><span class="comment">//2.1指明要查询哪一个java持久化类  ,可以等价于HQL语句：from com.qf.domain.Person</span></span><br><span class="line">cQuery.from(Person.class);</span><br><span class="line"><span class="comment">//3.执行Criteria查询</span></span><br><span class="line">List&lt;Person&gt; list = session.createQuery(cQuery).list();</span><br></pre></td></tr></table></figure>
<h6 id="5-4-5-2-条件查询"><a href="#5-4-5-2-条件查询" class="headerlink" title="5.4.5.2 条件查询"></a>5.4.5.2 条件查询</h6><p>1.常用条件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * where后跟的条件符：</span></span><br><span class="line"><span class="comment">     * &gt;      gt()  大于</span></span><br><span class="line"><span class="comment">     * &gt;=     ge()  大于等于</span></span><br><span class="line"><span class="comment">     * &lt;      lt()  小于</span></span><br><span class="line"><span class="comment">     * &lt;=     le()  小于等于</span></span><br><span class="line"><span class="comment">     * ==     equal()</span></span><br><span class="line"><span class="comment">     * !=     notEqual()</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * path&lt;Number&gt;：Integer，long,short.....</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * between A and B  在A和B之间</span></span><br><span class="line"><span class="comment">     * in (......)    在某个集合范围内</span></span><br><span class="line"><span class="comment">     * like           模糊匹配</span></span><br><span class="line"><span class="comment">     * notlike        不能匹配到的是</span></span><br><span class="line"><span class="comment">     * and        and()  和</span></span><br><span class="line"><span class="comment">     * or        or()   或者</span></span><br><span class="line"><span class="comment">     * 空                isNull</span></span><br><span class="line"><span class="comment">     *          isNotNUll</span></span><br><span class="line"><span class="comment">     */</span></span><br></pre></td></tr></table></figure>
<p>2.相关名称解释</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * JPA中的：</span></span><br><span class="line"><span class="comment">	 * Expression接口: 查询表达式 Type for query expressions.  提供的方法： isNull()  isNotNull()  in(Object... values)</span></span><br><span class="line"><span class="comment">	 * </span></span><br><span class="line"><span class="comment">	 * Path和Predicate是Expression的实现类</span></span><br><span class="line"><span class="comment">	 * Path:从绑定的类(type)或者集合(collection)中查找简单或者复杂的属性路径。</span></span><br><span class="line"><span class="comment">	 * 程序：from(Person.class)  查找指定属性 Path&lt;Integer&gt; path = get("属性名")：</span></span><br><span class="line"><span class="comment">	 *    </span></span><br><span class="line"><span class="comment">	 * Predicate：  同时发生的多个或者单个限制条件</span></span><br><span class="line"><span class="comment">	 * </span></span><br><span class="line"><span class="comment">	 * a conjunction(连接词，同时发生) or   disjunction(分离) of restrictions.    restrictions  限制条件</span></span><br><span class="line"><span class="comment">	 */</span></span><br></pre></td></tr></table></figure>
<p>3.代码实例</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.创建CriteriaBuilder对象，用来构建查询条件</span></span><br><span class="line">CriteriaBuilder cBuilder =session.getCriteriaBuilder();</span><br><span class="line"><span class="comment">//2.构建CriteriaQuery对象,同时指定的是查询的返回的结果类型</span></span><br><span class="line">CriteriaQuery&lt;Person&gt; criteriaQuery = cBuilder.createQuery(Person.class);</span><br><span class="line"><span class="comment">//2.1指定查询哪个类</span></span><br><span class="line">Root root = criteriaQuery.from(Person.class);		</span><br><span class="line"><span class="comment">//2.2构建查询条件 写where后的条件</span></span><br><span class="line"><span class="comment">//参数1：字段表达式 ，参数2：要比较的值</span></span><br><span class="line"><span class="comment">//需求：age大于20岁的</span></span><br><span class="line"><span class="comment">//从Person类上查找age属性的路径</span></span><br><span class="line"><span class="comment">//比较大小：gt,ge,lt，le,equal,notEqual</span></span><br><span class="line">Path&lt;Integer&gt; age =  root.get(<span class="string">"age"</span>);</span><br><span class="line"><span class="comment">//Predicate条件： gt(age, 20);  通过指定路径的属性映射的列名和后面的值去比较</span></span><br><span class="line">Predicate pAge= cBuilder.equal(age, <span class="number">18</span>);	</span><br><span class="line"><span class="comment">//条件必须放在where后面</span></span><br><span class="line">criteriaQuery.where(pAge);		</span><br><span class="line"><span class="comment">//3执行Criteria查询</span></span><br><span class="line">Query&lt;Person&gt; query = session.createQuery(criteriaQuery);	</span><br><span class="line">System.out.println(query.list());</span><br></pre></td></tr></table></figure>
<h6 id="5-4-5-3-分页查询"><a href="#5-4-5-3-分页查询" class="headerlink" title="5.4.5.3 分页查询"></a>5.4.5.3 分页查询</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.得到CriteriaBuilder的对象，构建查询条件的</span></span><br><span class="line">CriteriaBuilder cBuilder=  session.getCriteriaBuilder();</span><br><span class="line"><span class="comment">//2.得到CriteriaQuery对象,同时指定返回类型</span></span><br><span class="line">CriteriaQuery&lt;Person&gt; cQuery= cBuilder.createQuery(Person.class);</span><br><span class="line"><span class="comment">//3.查询指定的类</span></span><br><span class="line">Root root = cQuery.from(Person.class);</span><br><span class="line"><span class="comment">//4.执行查询</span></span><br><span class="line">Query&lt;Person&gt;  query = session.createQuery(cQuery);</span><br><span class="line">query.setFirstResult(<span class="number">0</span>);</span><br><span class="line">query.setMaxResults(<span class="number">2</span>);</span><br><span class="line">System.out.println(query.list());</span><br></pre></td></tr></table></figure>
<h6 id="5-4-5-4-排序查询"><a href="#5-4-5-4-排序查询" class="headerlink" title="5.4.5.4 排序查询"></a>5.4.5.4 排序查询</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.得到CriteriaBuilder的对象，构建查询条件的</span></span><br><span class="line">CriteriaBuilder cBuilder=  session.getCriteriaBuilder();</span><br><span class="line"><span class="comment">//2.得到CriteriaQuery对象,同时指定返回类型</span></span><br><span class="line">CriteriaQuery&lt;Person&gt; cQuery= cBuilder.createQuery(Person.class);</span><br><span class="line"><span class="comment">//3.查询指定的类</span></span><br><span class="line">Root root = cQuery.from(Person.class);</span><br><span class="line"><span class="comment">//3.1加排序 递增asc，递减desc  (属于条件类的)</span></span><br><span class="line">Path&lt;String&gt;  path=  root.get(<span class="string">"IDCard"</span>); 	</span><br><span class="line"><span class="comment">//3.2构建排序的条件</span></span><br><span class="line">Order order= cBuilder.desc(path);</span><br><span class="line"><span class="comment">//3.3加入查询的条件</span></span><br><span class="line">cQuery.orderBy(order);</span><br><span class="line"><span class="comment">//4.执行查询</span></span><br><span class="line">Query&lt;Person&gt; query = session.createQuery(cQuery);</span><br><span class="line">System.out.println(query.list());</span><br></pre></td></tr></table></figure>
<h6 id="5-4-5-5-聚合函数查询"><a href="#5-4-5-5-聚合函数查询" class="headerlink" title="5.4.5.5 聚合函数查询"></a>5.4.5.5 聚合函数查询</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//在JPA中的Criteria的所有查询中要执行调用的是以前sql中关键字的方法</span></span><br><span class="line">	 <span class="comment">//示例： from()  select()  orderby()    where() </span></span><br><span class="line">	<span class="comment">//但是条件必须都是CriteriaBuilder</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">//在JPA中的Criteria的聚合函数查询中：</span></span><br><span class="line">	<span class="comment">//1. sum,max,min的类型跟所查询的列的类型一致</span></span><br><span class="line">	<span class="comment">//3. avg  结果类型是Double类型</span></span><br><span class="line">	<span class="comment">//4. count  结果类型是Long类型</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//1.得到CriteriaBuilder的对象，构建查询条件的</span></span><br><span class="line">CriteriaBuilder cBuilder=  session.getCriteriaBuilder();</span><br><span class="line"><span class="comment">//2.得到CriteriaQuery对象,同时指定结果返回类型</span></span><br><span class="line">CriteriaQuery&lt;Long&gt; cQuery= cBuilder.createQuery(Long.class);</span><br><span class="line"><span class="comment">//3.查询指定的类</span></span><br><span class="line">Root root = cQuery.from(Person.class);</span><br><span class="line"><span class="comment">//聚合函数select 后和from前</span></span><br><span class="line">        	</span><br><span class="line">    <span class="comment">//1.需求1：sum(age)</span></span><br><span class="line">        <span class="comment">//1.1先找出age列的路径</span></span><br><span class="line">        <span class="comment">/*Path&lt;Integer&gt; agePath = root.get("age");</span></span><br><span class="line"><span class="comment">        //1.2根据sum构建条件</span></span><br><span class="line"><span class="comment">        Expression&lt;Integer&gt; expression = cBuilder.sum(agePath);</span></span><br><span class="line"><span class="comment">        cQuery.select(expression);*/</span></span><br><span class="line">        	</span><br><span class="line">   <span class="comment">//2.需求2: count(age)</span></span><br><span class="line"> 	   Path&lt;Long&gt; agePath = root.get(<span class="string">"age"</span>);</span><br><span class="line">      <span class="comment">//1.2根据sum构建条件</span></span><br><span class="line">       Expression&lt;Long&gt; expression = cBuilder.count(agePath);</span><br><span class="line">       cQuery.select(expression);</span><br><span class="line">        	</span><br><span class="line">       Long sum = session.createQuery(cQuery).uniqueResult();</span><br><span class="line">        System.out.println(sum);</span><br></pre></td></tr></table></figure>
<h6 id="5-4-5-6-查询多个列"><a href="#5-4-5-6-查询多个列" class="headerlink" title="5.4.5.6 查询多个列"></a>5.4.5.6 查询多个列</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">	    <span class="comment">//1.得到CriteriaBuilder的对象，构建查询条件的</span></span><br><span class="line">       	CriteriaBuilder cBuilder=  session.getCriteriaBuilder();</span><br><span class="line">       	<span class="comment">//2.得到CriteriaQuery对象,同时指定返回类型</span></span><br><span class="line">       	CriteriaQuery&lt;Object[]&gt; cQuery= cBuilder.createQuery(Object[].class);</span><br><span class="line">           <span class="comment">//3.查询指定的类</span></span><br><span class="line">       	Root root = cQuery.from(Person.class);</span><br><span class="line">       	<span class="comment">//3.1 先查找name和address属性所在的Path路径</span></span><br><span class="line">       	Path namePath=  root.get(<span class="string">"name"</span>);</span><br><span class="line">       	Path addressPath=  root.get(<span class="string">"address"</span>);</span><br><span class="line">       	<span class="comment">//3.2. 最终目的：select  name,address from  com.qf.domainn.Person</span></span><br><span class="line">       	<span class="comment">//方式一：</span></span><br><span class="line">       	<span class="comment">//cQuery.multiselect(namePath,addressPath);</span></span><br><span class="line">       	<span class="comment">//方式二：</span></span><br><span class="line"><span class="comment">//cBuilder.array(namePath,addressPath)表示把所有条件放在一个array组成一个新的对象</span></span><br><span class="line">       	cQuery.select(cBuilder.array(namePath,addressPath));</span><br><span class="line">       	</span><br><span class="line">       	<span class="comment">//4.执行查询</span></span><br><span class="line">       	List&lt;Object[]&gt; list = session.createQuery(cQuery).list();</span><br><span class="line">       	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; list.size(); i++) &#123;</span><br><span class="line">       		Object[] objects = list.get(i);</span><br><span class="line">       		System.out.println(objects[<span class="number">0</span>]+<span class="string">"==ffff=="</span>+objects[<span class="number">1</span>]);</span><br><span class="line">		&#125;</span><br></pre></td></tr></table></figure>
<h6 id="5-4-5-7-离线查询"><a href="#5-4-5-7-离线查询" class="headerlink" title="5.4.5.7 离线查询"></a>5.4.5.7 离线查询</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.创建一个DetachedCriteria类，并且指明要查询的持久化类</span></span><br><span class="line">DetachedCriteria detachedCriteria = DetachedCriteria.forClass(Person.class);</span><br><span class="line"><span class="comment">//2.添加查询条件</span></span><br><span class="line"><span class="comment">//2.1 Restrictions封装了大量的查询条件，例如：gt,ge，lt,eq........</span></span><br><span class="line">detachedCriteria.add(Restrictions.gt(<span class="string">"age"</span>, <span class="number">18</span>));	  	</span><br><span class="line"><span class="comment">//执行数据增删查改操作：</span></span><br><span class="line">Criteria c = detachedCriteria.getExecutableCriteria(session);</span><br><span class="line">System.out.println(c.list());</span><br></pre></td></tr></table></figure>
<p>离线查询的聚合函数查询：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.创建一个DetachedCriteria类，并且指明要查询的持久化类</span></span><br><span class="line">DetachedCriteria  detachedCriteria= DetachedCriteria.forClass(Person.class);	  	</span><br><span class="line"><span class="comment">//执行数据增删查改操作：</span></span><br><span class="line">Criteria c = detachedCriteria.getExecutableCriteria(session);</span><br><span class="line"><span class="comment">/* c.setProjection(Projections.max("age"));</span></span><br><span class="line"><span class="comment">c.setProjection(Projections.min("age"));</span></span><br><span class="line"><span class="comment">c.setProjection(Projections.sum("age"));</span></span><br><span class="line"><span class="comment">c.setProjection(Projections.avg("age"));*/</span></span><br><span class="line">c.setProjection(Projections.count(<span class="string">"IDCard"</span>));</span><br><span class="line">System.out.println(c.uniqueResult());</span><br></pre></td></tr></table></figure>
<h6 id="5-4-5-8-分层思想中的Criteria查询"><a href="#5-4-5-8-分层思想中的Criteria查询" class="headerlink" title="5.4.5.8 分层思想中的Criteria查询"></a>5.4.5.8 分层思想中的Criteria查询</h6><ol>
<li>在线查询</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *    在线查询：</span></span><br><span class="line"><span class="comment"> *    完全依赖于Session(包含数据库操作的条件构建以及数据库操作的增删查改)  </span></span><br><span class="line"><span class="comment"> *    分层思想： dao层只做增删查改</span></span><br><span class="line"><span class="comment"> *   web层----------------- service层-------------------dao层</span></span><br><span class="line"><span class="comment"> * 取参数调用service         业务逻辑(事务)            条件构建和增删查改</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *   在线查询：service和web层还是以前的写法不需要任何变化。</span></span><br><span class="line"><span class="comment"> *    dao层书写方式如下：</span></span><br><span class="line"><span class="comment"> *    <span class="doctag">@Override</span></span></span><br><span class="line"><span class="comment">	  public Person queryPersonById(String  id) &#123;</span></span><br><span class="line"><span class="comment">		// TODO Auto-generated method stub</span></span><br><span class="line"><span class="comment">		Session session = HibernateUtils.getCurrentSession();</span></span><br><span class="line"><span class="comment">	    //1.CriteriaBuilder</span></span><br><span class="line"><span class="comment">		CriteriaBuilder cb = session.getCriteriaBuilder();</span></span><br><span class="line"><span class="comment">		//2.CriteriaQuery</span></span><br><span class="line"><span class="comment">	    CriteriaQuery&lt;Person&gt; cQuery = cb.createQuery(Person.class);    </span></span><br><span class="line"><span class="comment">	    //3.指定查询那个类</span></span><br><span class="line"><span class="comment">	    Root root = cQuery.from(Person.class);	    </span></span><br><span class="line"><span class="comment">	    //构建条件</span></span><br><span class="line"><span class="comment">	    Path&lt;String&gt; idPath= root.get("IDCard");</span></span><br><span class="line"><span class="comment">	    Predicate predicate =cb.equal(idPath, id);</span></span><br><span class="line"><span class="comment">	    cQuery.where(predicate);   </span></span><br><span class="line"><span class="comment">	    //4.执行查询</span></span><br><span class="line"><span class="comment">	    Person person = session.createQuery(cQuery).uniqueResult();</span></span><br><span class="line"><span class="comment">		return person;</span></span><br><span class="line"><span class="comment">	&#125;</span></span><br></pre></td></tr></table></figure>
<ol>
<li>离线查询</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">离线查询：数据库操作的条件构建不需要依赖于session而创建</span><br><span class="line"> <span class="comment">/* 分层思想中：</span></span><br><span class="line"><span class="comment"> *   web层----------------- service层-----------------dao层</span></span><br><span class="line"><span class="comment"> * 取参数调用service         业务逻辑(事务)            增删查改</span></span><br><span class="line"><span class="comment"> * 查询条件的构建都放在web层。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *  web层关键代码如下：</span></span><br><span class="line"><span class="comment"> public static void main(String[] args) &#123;</span></span><br><span class="line"><span class="comment">		//查询id为xxx的值,示例：IDcard=8a8003c55fe18602015fe18605800000</span></span><br><span class="line"><span class="comment">		//扮演的是web层的Servlet的角色</span></span><br><span class="line"><span class="comment">		//1.获取请求参数</span></span><br><span class="line"><span class="comment">		String id="8a8003c55fe18602015fe18605800000";</span></span><br><span class="line"><span class="comment">		//2.调用service层处理</span></span><br><span class="line"><span class="comment">		PersonService personService =new PersonServiceImpl();</span></span><br><span class="line"><span class="comment">		//构建查询条件</span></span><br><span class="line"><span class="comment">		DetachedCriteria criteria=DetachedCriteria.forClass(Person.class);</span></span><br><span class="line"><span class="comment">		criteria.add(Restrictions.idEq(id));</span></span><br><span class="line"><span class="comment">		</span></span><br><span class="line"><span class="comment">		Person person = personService.findPersonById(criteria);</span></span><br><span class="line"><span class="comment">		System.out.println(person);</span></span><br><span class="line"><span class="comment">		//3.得到结果</span></span><br><span class="line"><span class="comment">		if (person!=null) &#123;</span></span><br><span class="line"><span class="comment">			System.out.println("查询成功");</span></span><br><span class="line"><span class="comment">		&#125;else &#123;</span></span><br><span class="line"><span class="comment">			System.out.println("查询失败");</span></span><br><span class="line"><span class="comment">		&#125;</span></span><br><span class="line"><span class="comment">	&#125;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *dao层代码如下： </span></span><br><span class="line"><span class="comment"> *@Override</span></span><br><span class="line"><span class="comment">	public Person queryPersonById(DetachedCriteria detachedCriteria) &#123;</span></span><br><span class="line"><span class="comment">		// TODO Auto-generated method stub</span></span><br><span class="line"><span class="comment">		//真正的查询</span></span><br><span class="line"><span class="comment">		Session session = HibernateUtils.getCurrentSession();</span></span><br><span class="line"><span class="comment">		//执行封装的条件</span></span><br><span class="line"><span class="comment">	    Criteria c = detachedCriteria.getExecutableCriteria(session);   </span></span><br><span class="line"><span class="comment">	    //取结果</span></span><br><span class="line"><span class="comment">	     Person person =  (Person) c.uniqueResult();</span></span><br><span class="line"><span class="comment">		return person;</span></span><br><span class="line"><span class="comment">	&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>
<h1 id="Hibernate的对象三种状态"><a href="#Hibernate的对象三种状态" class="headerlink" title="Hibernate的对象三种状态"></a>Hibernate的对象三种状态</h1><h2 id="1-瞬时状态-Transient"><a href="#1-瞬时状态-Transient" class="headerlink" title="1.瞬时状态  Transient"></a>1.瞬时状态  Transient</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">瞬时化对象没有id,而且没有和session关联</span><br></pre></td></tr></table></figure>
<h2 id="2-持久状态-persistent"><a href="#2-持久状态-persistent" class="headerlink" title="2.持久状态  persistent"></a>2.持久状态  persistent</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">持久化对象有id，而且跟session有关联</span><br></pre></td></tr></table></figure>
<h2 id="3-游离状态-托管状态-detached"><a href="#3-游离状态-托管状态-detached" class="headerlink" title="3.游离状态(托管状态) detached"></a>3.游离状态(托管状态) detached</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">游离化对象有id,但是跟session没有关联</span><br></pre></td></tr></table></figure>
<p><img src="F:\老师代码\Stage3\Hibernate\day04-Criteria在线离线查询,Hibernate缓存及三种状态\Hibernate第四天下午\笔记\hibernate对象三种状态\Hibernate的对象三种状态状态转化图.bmp" alt="Hibernate的对象三种状态状态转化图"></p>
<h1 id="Hibernate缓存"><a href="#Hibernate缓存" class="headerlink" title="Hibernate缓存"></a>Hibernate缓存</h1><h2 id="1-缓存概念"><a href="#1-缓存概念" class="headerlink" title="1.缓存概念"></a>1.缓存概念</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1.缓存就是一块内存区域。介于应用程序和物理数据源(例如：电脑磁盘)之间</span><br><span class="line">2.提高程序的运行速率， 从而提高了用户的体验度。</span><br><span class="line">3.缓存就是目标数据源的一个复本(复制)。应用程序直接访问缓存。一般会在特定时间刷新缓存。</span><br></pre></td></tr></table></figure>
<h2 id="2-Hibernate缓存"><a href="#2-Hibernate缓存" class="headerlink" title="2.Hibernate缓存"></a>2.Hibernate缓存</h2><p>持久化层(dao层)，对数据(操作的数据库中的数据)的备份</p>
<h3 id="2-1-Hibernate一级缓存-Session级别"><a href="#2-1-Hibernate一级缓存-Session级别" class="headerlink" title="2.1 Hibernate一级缓存(Session级别)"></a>2.1 Hibernate一级缓存(Session级别)</h3><p>Session级别的缓存：Hibernate内置的，不能卸除。如果session关闭了，缓存就清空了。</p>
<p>适用情况： 一次业务功能操作内有多次操作数据库。只访问一次，后续访问的是缓存数据。</p>
<p>案例1：以查询为例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test01</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		Session session = HibernateUtils.openSession();</span><br><span class="line">		Transaction  transaction = session.beginTransaction();</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="comment">//多次查询：观察到的结果是，多次查询只执行一次sql,</span></span><br><span class="line">			<span class="comment">//后续的查询结果和第一次查询结果一样的。</span></span><br><span class="line">			Customer customer1 = session.get(Customer.class, <span class="number">2</span>);<span class="comment">//持久状态</span></span><br><span class="line">               <span class="comment">//清楚所有缓存</span></span><br><span class="line">			 <span class="comment">// session.clear();</span></span><br><span class="line">			<span class="comment">//表示从缓存中移除指定的缓存对象</span></span><br><span class="line">			<span class="comment">//session.evict(customer1);</span></span><br><span class="line">			</span><br><span class="line">			Customer customer2 = session.get(Customer.class, <span class="number">2</span>);			</span><br><span class="line">			<span class="comment">//session.evict(customer2);	</span></span><br><span class="line">			Customer customer3 = session.get(Customer.class, <span class="number">2</span>);	</span><br><span class="line">			System.out.println(customer1.equals(customer2));</span><br><span class="line">			System.out.println(customer2.equals(customer3));</span><br><span class="line">			transaction.commit();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			<span class="comment">// <span class="doctag">TODO:</span> handle exception</span></span><br><span class="line">			<span class="keyword">if</span> (transaction!=<span class="keyword">null</span>) &#123;</span><br><span class="line">				transaction.rollback();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">结论：</span><br><span class="line">     使用session多次查询。只要查询都会将查询的结果存储到缓存区域。那下次再查询直接从缓存中查找，找到就直接获取，没有找到再次发起sql去连接数据库查询</span><br></pre></td></tr></table></figure>
<p>案例： 快照</p>
<p>快照也是一块内存区域。快照是session缓存中一部分。</p>
<p>快照的目的是在提交事务的时候，会比较缓存和快照内容。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">案例<span class="number">1</span>：缓存和快照的不一样的情况,要更新一致后发送sql语句，操作数据库</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test02</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		Session session = HibernateUtils.openSession();</span><br><span class="line">		Transaction  transaction = session.beginTransaction();</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="comment">//持久状态的对象可以直接调用set开头的方法进行update操作</span></span><br><span class="line">			<span class="comment">//把得到的对象在session缓存中存储了，而且在快照中也存储了</span></span><br><span class="line">			Customer customer1 = session.find(Customer.class, <span class="number">2</span>);<span class="comment">//持久状态</span></span><br><span class="line">			</span><br><span class="line">              <span class="comment">//更新session缓存</span></span><br><span class="line">			customer1.setCust_name(<span class="string">"蘑菇22"</span>);</span><br><span class="line">			 <span class="comment">//更新session缓存</span></span><br><span class="line">			customer1.setCust_name(<span class="string">"蘑菇33"</span>);</span><br><span class="line">			</span><br><span class="line">	<span class="comment">//commit时，比较session缓存和快照中的内容，一致，不会发送sql,不一致发送sql</span></span><br><span class="line">			transaction.commit();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			<span class="comment">// <span class="doctag">TODO:</span> handle exception</span></span><br><span class="line">			<span class="keyword">if</span> (transaction!=<span class="keyword">null</span>) &#123;</span><br><span class="line">				transaction.rollback();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">案例<span class="number">2</span>：缓存和快照的一样的情况.不会发送sql语句操作数据库</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test03</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		Session session = HibernateUtils.openSession();</span><br><span class="line">		Transaction  transaction = session.beginTransaction();</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="comment">//持久状态的对象可以直接调用set开头的方法进行update操作</span></span><br><span class="line">			Customer customer1 = session.find(Customer.class, <span class="number">2</span>);<span class="comment">//持久状态</span></span><br><span class="line">				</span><br><span class="line">			customer1.setCust_name(<span class="string">"蘑菇33"</span>);</span><br><span class="line">			customer1.setCust_name(<span class="string">"蘑菇33"</span>);</span><br><span class="line">			</span><br><span class="line">			transaction.commit();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			<span class="comment">// <span class="doctag">TODO:</span> handle exception</span></span><br><span class="line">			<span class="keyword">if</span> (transaction!=<span class="keyword">null</span>) &#123;</span><br><span class="line">				transaction.rollback();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<h1 id="Hibernate的二级缓存"><a href="#Hibernate的二级缓存" class="headerlink" title="Hibernate的二级缓存"></a>Hibernate的二级缓存</h1><p>Hibernate的二级缓存(SessionFactory级别) 线程安全。</p>
<p>适用情况：多次业务操作。<br>Hibernate的二级缓存默认没有的。需要开发者自己配置。添加额外的包。常用的二级缓存Ehcache.</p>
<h3 id="1-Hibernate实现二级缓存的步骤："><a href="#1-Hibernate实现二级缓存的步骤：" class="headerlink" title="1. Hibernate实现二级缓存的步骤："></a>1. Hibernate实现二级缓存的步骤：</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">   1.添加二级缓存的包(下载的库/lib/optional/ehcache/xx.jar(3个))</span><br><span class="line">2.在主配置文件(hibernate.cfg.xml)配置开启二级缓存</span><br><span class="line">  <span class="comment">&lt;!--配置开启二级缓存  --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.cache.use_second_level_cache"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 指定使用哪个二级缓存(Hibernate二级缓存有5种实现，Ehcache常用的一种) --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.cache.region.factory_class"</span>&gt;</span>org.hibernate.cache.ehcache.EhCacheRegionFactory<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"> 3.配置缓存的配置文件 ehcache.xml(hibernate提供了，开发者只需要根据自己的需求更改缓存目录及内容即可)</span><br><span class="line">        ehcache.xml该文件的位置：hibernate下载的库/project/etc/ehcache.xml</span><br><span class="line">            关键代码如下：</span><br><span class="line">		     <span class="comment">&lt;!--配置缓存的磁盘目录(该目录要存在)  --&gt;</span></span><br><span class="line">			  <span class="tag">&lt;<span class="name">diskStore</span> <span class="attr">path</span>=<span class="string">"C:\hibernatecache"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">				<span class="comment">&lt;!-- name:指明要缓存的持久化类：包名+类名 --&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">cache</span> <span class="attr">name</span>=<span class="string">"com.qf.domain.Customer"</span></span></span><br><span class="line"><span class="tag">					<span class="attr">maxElementsInMemory</span>=<span class="string">"10000"</span></span></span><br><span class="line"><span class="tag">					<span class="attr">eternal</span>=<span class="string">"false"</span></span></span><br><span class="line"><span class="tag">					<span class="attr">timeToIdleSeconds</span>=<span class="string">"300"</span></span></span><br><span class="line"><span class="tag">					<span class="attr">timeToLiveSeconds</span>=<span class="string">"600"</span></span></span><br><span class="line"><span class="tag">					<span class="attr">overflowToDisk</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">					/&gt;</span></span><br><span class="line"></span><br><span class="line">   4.在缓存的持久化类映射的地告诉程序缓存的策略</span><br><span class="line">	       ready-only  默认的，常用的,缓存数据无需修改，只需要读取即可。</span><br><span class="line">		   read-write  需要修改缓存数据，常用于对缓存进行读和写。数据库隔离级别不能为serializable(可串行化)</span><br><span class="line">		   notstrict-read-write 只是偶尔更新数据。(示  例：两个事务同时更新一条数据，非常该策略。)</span><br><span class="line">	       transaction：ehcache不支持。</span><br><span class="line">	示例：以下配置映射文件中的class的里面</span><br><span class="line">	<span class="comment">&lt;!--设置缓存策略  --&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">cache</span> <span class="attr">usage</span>=<span class="string">"read-only"</span>/&gt;</span></span><br><span class="line">        5.验证测试：</span><br></pre></td></tr></table></figure>
<h3 id="2-案例1"><a href="#2-案例1" class="headerlink" title="2. 案例1"></a>2. 案例1</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">//证明了二级缓存存在</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test01</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	Session session =   HibernateUtils.getCurrentSession();</span><br><span class="line">	Transaction t=  session.beginTransaction();</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		Customer customer1 = session.get(Customer.class,<span class="number">1</span>);</span><br><span class="line">		<span class="comment">//一级缓存session移除</span></span><br><span class="line">		session.evict(customer1);</span><br><span class="line">		<span class="comment">//再次查找，依然不会发起新的sql去查询，而是去二级缓存查询</span></span><br><span class="line">		Customer customer2 = session.get(Customer.class,<span class="number">1</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//Customer customer3 = session.get(Customer.class,1);</span></span><br><span class="line">		</span><br><span class="line">		System.out.println(customer1.equals(customer2));</span><br><span class="line">		<span class="comment">//System.out.println(customer2.equals(customer3));</span></span><br><span class="line">		t.commit();</span><br><span class="line">	&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">		<span class="comment">// <span class="doctag">TODO:</span> handle exception</span></span><br><span class="line">		<span class="keyword">if</span> (t!=<span class="keyword">null</span>) &#123;</span><br><span class="line">			t.rollback();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-案例2"><a href="#3-案例2" class="headerlink" title="3. 案例2"></a>3. 案例2</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//证明二级缓存的级别是sessionFacotry级别</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test02</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	Configuration configuration =<span class="keyword">new</span> Configuration();</span><br><span class="line">	configuration.configure();</span><br><span class="line">	SessionFactory sessionFactory = 	configuration.buildSessionFactory();</span><br><span class="line">	Session session = sessionFactory.openSession();</span><br><span class="line">	Customer customer = session.get(Customer.class, <span class="number">1</span>);</span><br><span class="line">	session.evict(customer);</span><br><span class="line">	Customer customer1 = session.get(Customer.class, <span class="number">1</span>);</span><br><span class="line">	sessionFactory.close();</span><br><span class="line">	</span><br><span class="line">	System.out.println(<span class="string">"================="</span>);</span><br><span class="line">	Configuration configuration1=<span class="keyword">new</span> Configuration();</span><br><span class="line">	configuration1.configure();</span><br><span class="line">	SessionFactory sessionFactory1 = 	configuration1.buildSessionFactory();</span><br><span class="line">	Session session1 = sessionFactory1.openSession();</span><br><span class="line">	Customer customer2 = session1.get(Customer.class, <span class="number">1</span>);</span><br><span class="line">    System.out.println(customer2); </span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-案例3"><a href="#4-案例3" class="headerlink" title="4. 案例3"></a>4. 案例3</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//证明二级缓存的级别是sessionFacotry级别</span></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test03</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	Session session = HibernateUtils.openSession();</span><br><span class="line">	Customer customer = session.get(Customer.class, <span class="number">1</span>);</span><br><span class="line">	System.out.println(customer);</span><br><span class="line">	session.close();	</span><br><span class="line">	</span><br><span class="line">	Session session1 = HibernateUtils.openSession();</span><br><span class="line">	Customer customer1 = session1.get(Customer.class, <span class="number">1</span>);</span><br><span class="line">	System.out.println(customer1);</span><br><span class="line">	session1.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="5-结论"><a href="#5-结论" class="headerlink" title="5. 结论"></a>5. 结论</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">结论：</span><br><span class="line"> *   二级缓存和一级缓存的关系：</span><br><span class="line"> *    默认使用一级缓存，当一级缓存不存在的情况下，去读取二级缓存。</span><br><span class="line"> *    可以认为：二级缓存是一级缓存的补充。</span><br><span class="line"> *     </span><br><span class="line"> *     重要的信息优先在一级缓存存储，不太重要的信息在二级缓存。</span><br><span class="line"> * 二级缓存通常用于什么情况？</span><br><span class="line"> *    不太重要的信息。</span><br><span class="line"> *    很少被修改的数据。</span><br><span class="line"> *    常量数据。   </span><br><span class="line"> *   补充：一级缓存Session级别.如何清除一级缓存： </span><br><span class="line"> *     <span class="number">1</span>.evict(Object o) </span><br><span class="line"> *     <span class="number">2</span>.clear() </span><br><span class="line"> *     <span class="number">3</span>.close()    </span><br><span class="line"> *     二级缓存SessionFactory级别，如何清除二级缓存：</span><br><span class="line"> *     <span class="number">1</span>.sessionFactory.close()   </span><br><span class="line"> *     <span class="number">2</span>.把缓存文件删除(不建议)</span><br><span class="line"> */</span><br></pre></td></tr></table></figure>
<h2 id="三-多表关系映射"><a href="#三-多表关系映射" class="headerlink" title="三 多表关系映射"></a>三 多表关系映射</h2><h3 id="1-一对一-会用即可"><a href="#1-一对一-会用即可" class="headerlink" title="1.一对一(会用即可)"></a>1.一对一(会用即可)</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">主表：没有外键 有主键</span><br><span class="line"></span><br><span class="line">从表：拥有外键的是从表</span><br><span class="line"></span><br><span class="line">先操作从表，再去操作主表</span><br><span class="line"></span><br><span class="line">one-to-one  ，many-to-one 只是表达多个表之间的关系。</span><br><span class="line"></span><br><span class="line">外键：目的是多表连接</span><br><span class="line">主键：目的是唯一标识数据</span><br></pre></td></tr></table></figure>
<p>示例： 一个人对应一个身份证  ，一夫一妻制,  一个萝卜一个坑。。。。</p>
<p>一对一的关系用程序如何描述：</p>
<p>示例：一夫一妻制</p>
<p>Husband.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Husband</span></span>&#123;</span><br><span class="line">   <span class="keyword">private</span> Integer marryId; <span class="comment">//结婚编号</span></span><br><span class="line">   <span class="keyword">private</span> String name; <span class="comment">//名称</span></span><br><span class="line">   <span class="keyword">private</span> Integer age; <span class="comment">//年龄</span></span><br><span class="line">   <span class="keyword">private</span>  Integer  hid; <span class="comment">//丈夫的身份证号   </span></span><br><span class="line">   <span class="keyword">private</span>  Wife wife; <span class="comment">//丈夫和妻子有一对一的关系 </span></span><br><span class="line">   set/get....</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Wife.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Wife</span></span>&#123;</span><br><span class="line">   <span class="keyword">private</span> Integer marryId; <span class="comment">//结婚编号</span></span><br><span class="line">   <span class="keyword">private</span> String name; <span class="comment">//名称</span></span><br><span class="line">   <span class="keyword">private</span> Integer age; <span class="comment">//年龄</span></span><br><span class="line">   <span class="keyword">private</span>  Integer  wid; <span class="comment">//妻子的身份证号 </span></span><br><span class="line">   <span class="keyword">private</span>   Husband  husband;<span class="comment">//妻子和丈夫有一对一的关系</span></span><br><span class="line">   set/get....</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="1-1-按照主键映射-主键都是一样的"><a href="#1-1-按照主键映射-主键都是一样的" class="headerlink" title="1.1 按照主键映射(主键都是一样的)"></a>1.1 按照主键映射(主键都是一样的)</h4><p><strong><em>用已有的主键充当外键去连接表来表示关系</em></strong></p>
<p>元数据表示配置文件：</p>
<h5 id="1-1-1-映射文件"><a href="#1-1-1-映射文件" class="headerlink" title="1.1.1 映射文件"></a>1.1.1 映射文件</h5><h6 id="Husband-hbm-xml"><a href="#Husband-hbm-xml" class="headerlink" title="Husband.hbm.xml"></a>Husband.hbm.xml</h6><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span>?&gt;</span><br><span class="line">&lt;!DOCTYPE hibernate-mapping PUBLIC </span><br><span class="line">    <span class="string">"-//Hibernate/Hibernate Mapping DTD 3.0//EN"</span></span><br><span class="line">    <span class="string">"http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd"</span>&gt;</span><br><span class="line">&lt;hibernate-mapping <span class="keyword">package</span>=<span class="string">"com.qf.domain"</span>&gt;</span><br><span class="line">	&lt;<span class="class"><span class="keyword">class</span> <span class="title">name</span></span>=<span class="string">"Husband"</span> table=<span class="string">"husband"</span>&gt;</span><br><span class="line">		&lt;id name=<span class="string">"marryId"</span>&gt;</span><br><span class="line">			&lt;generator class="native"&gt;&lt;/generator&gt;</span><br><span class="line">		&lt;/id&gt;</span><br><span class="line">		&lt;property name="name"&gt;&lt;/property&gt;</span><br><span class="line">		&lt;property name="age"&gt;&lt;/property&gt;</span><br><span class="line">		&lt;property name="hid"&gt;&lt;/property&gt;</span><br><span class="line">	  &lt;!-- 表达的是一对一的关系   constrained=<span class="string">"true"</span>表示外键约束--&gt;</span><br><span class="line">	  &lt;one-to-one name="wife" constrained="true"&gt;&lt;/one-to-one&gt;</span><br><span class="line">	&lt;/class&gt;</span><br><span class="line">&lt;/hibernate-mapping&gt;</span><br></pre></td></tr></table></figure>
<h6 id="Wife-hbm-xml"><a href="#Wife-hbm-xml" class="headerlink" title="Wife.hbm.xml"></a>Wife.hbm.xml</h6><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span>?&gt;</span><br><span class="line">&lt;!DOCTYPE hibernate-mapping PUBLIC </span><br><span class="line">    <span class="string">"-//Hibernate/Hibernate Mapping DTD 3.0//EN"</span></span><br><span class="line">    <span class="string">"http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd"</span>&gt;</span><br><span class="line">    &lt;hibernate-mapping <span class="keyword">package</span>=<span class="string">"com.qf.domain"</span>&gt;</span><br><span class="line">	&lt;<span class="class"><span class="keyword">class</span> <span class="title">name</span></span>=<span class="string">"Wife"</span> table=<span class="string">"wife"</span>&gt;</span><br><span class="line">		&lt;id name=<span class="string">"marryId"</span>&gt;</span><br><span class="line">			&lt;generator class="native"&gt;&lt;/generator&gt;</span><br><span class="line">		&lt;/id&gt;</span><br><span class="line">		&lt;property name="name"&gt;&lt;/property&gt;</span><br><span class="line">		&lt;property name="age"&gt;&lt;/property&gt;</span><br><span class="line">		&lt;property name="wid"&gt;&lt;/property&gt;</span><br><span class="line">	  &lt;!-- 表达一对一的关系：</span><br><span class="line">	      当前Wife和name变量代指的类映射的表建立一对一的关系。 --&gt;</span><br><span class="line">	   &lt;one-to-one name="husband"&gt;&lt;/one-to-one&gt;</span><br><span class="line">	&lt;/class&gt;</span><br><span class="line">&lt;/hibernate-mapping&gt;</span><br></pre></td></tr></table></figure>
<h5 id="1-1-2-测试"><a href="#1-1-2-测试" class="headerlink" title="1.1.2 测试"></a>1.1.2 测试</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * one-to-one表示一对一的关系。  </span></span><br><span class="line"><span class="comment"> * constrained="true"表示外键约束。当前类映射表的主键作为外键去连接另外一个表的主键。</span></span><br><span class="line"><span class="comment"> * 示例： husband的主键作为外键去连接wife的主键。建立了一对一的关系(夫妻关系)。</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * 主表 wife</span></span><br><span class="line"><span class="comment"> * 副表(从表) husband  维护外键,通过外键去连接主表的主键</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * 手动删除表的先删除副表。再删除主表。</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * 方式一： 按照主键关系映射的(用已有的主键充当外键去连接关系) 上午重点：</span></span><br><span class="line"><span class="comment"> * 方式二：按照外键关系映射的。(给表插入额外的一个列作为外键去连接另外一个表) </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test01</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		Session session = HibernateUtils.getCurrentSession();</span><br><span class="line">		Transaction transaction = session.beginTransaction();</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			Husband husband =<span class="keyword">new</span> Husband();</span><br><span class="line">			husband.setName(<span class="string">"丈夫"</span>);</span><br><span class="line">			</span><br><span class="line">			Wife wife =<span class="keyword">new</span> Wife();</span><br><span class="line">			wife.setName(<span class="string">"妻子"</span>);</span><br><span class="line">			</span><br><span class="line">			<span class="comment">//表达一对一的关系</span></span><br><span class="line">			husband.setWife(wife);			</span><br><span class="line">			wife.setHusband(husband);</span><br><span class="line">			</span><br><span class="line">			</span><br><span class="line">			<span class="comment">//有约束关系的表后插入(该表插入的时候要 找对应的关系的那条数据)</span></span><br><span class="line">			<span class="comment">//先插入主表</span></span><br><span class="line">			session.save(wife);</span><br><span class="line">			<span class="comment">//后插入副表</span></span><br><span class="line">			session.save(husband);	</span><br><span class="line">			transaction.commit();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			<span class="comment">// <span class="doctag">TODO:</span> handle exception</span></span><br><span class="line">			<span class="keyword">if</span> (transaction!=<span class="keyword">null</span>) &#123;</span><br><span class="line">				transaction.rollback();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<h4 id="1-2-按照外键映射"><a href="#1-2-按照外键映射" class="headerlink" title="1.2 按照外键映射"></a>1.2 按照外键映射</h4><p><strong><em>给表额外插入一个列作为外键去连接另一个表</em></strong></p>
<h5 id="1-2-1-java持久化类"><a href="#1-2-1-java持久化类" class="headerlink" title="1.2.1 java持久化类"></a>1.2.1 java持久化类</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Wife.java</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Wife</span></span>&#123;</span><br><span class="line">   <span class="keyword">private</span> Integer wid; <span class="comment">//妻子的身份证号(主键)</span></span><br><span class="line">   <span class="keyword">private</span> String name; <span class="comment">//名称</span></span><br><span class="line">   <span class="keyword">private</span> Integer age; <span class="comment">//年龄</span></span><br><span class="line">   <span class="keyword">private</span>  Integer  marryId; <span class="comment">//结婚编号  </span></span><br><span class="line">   <span class="keyword">private</span>   Husband  husband;<span class="comment">//妻子和丈夫有一对一的关系</span></span><br><span class="line">   set/get.... </span><br><span class="line">&#125;</span><br><span class="line">Husband.java</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Husband</span></span>&#123;</span><br><span class="line">   <span class="keyword">private</span> Integer hid; <span class="comment">//丈夫的身份证号 (主键) </span></span><br><span class="line">   <span class="keyword">private</span> String name; <span class="comment">//名称</span></span><br><span class="line">   <span class="keyword">private</span> Integer age; <span class="comment">//年龄</span></span><br><span class="line">   <span class="keyword">private</span>  Integer  marryId; <span class="comment">//结婚编号</span></span><br><span class="line">   <span class="keyword">private</span>  Wife wife; <span class="comment">//丈夫和妻子有一对一的关系 </span></span><br><span class="line">   set/get....</span><br><span class="line">   </span><br><span class="line">   <span class="comment">//理解：  多个表中主键都有各自的含义及内容的时候(主键不一样)</span></span><br><span class="line">   <span class="comment">//给husband额外插入一个列wife_id1，作为外键去连接wife表</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="1-2-2-映射文件"><a href="#1-2-2-映射文件" class="headerlink" title="1.2.2  映射文件"></a>1.2.2  映射文件</h5><h6 id="Husband-hbm-xml-1"><a href="#Husband-hbm-xml-1" class="headerlink" title="Husband.hbm.xml"></a>Husband.hbm.xml</h6><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span>?&gt;</span><br><span class="line">&lt;!DOCTYPE hibernate-mapping PUBLIC </span><br><span class="line">    <span class="string">"-//Hibernate/Hibernate Mapping DTD 3.0//EN"</span></span><br><span class="line">    <span class="string">"http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd"</span>&gt;</span><br><span class="line">&lt;hibernate-mapping <span class="keyword">package</span>=<span class="string">"com.qf.domain"</span>&gt;</span><br><span class="line">	&lt;<span class="class"><span class="keyword">class</span> <span class="title">name</span></span>=<span class="string">"Husband"</span> table=<span class="string">"husband"</span>&gt;</span><br><span class="line">		&lt;id name=<span class="string">"hid"</span>&gt;</span><br><span class="line">			&lt;generator class="native"&gt;&lt;/generator&gt;</span><br><span class="line">		&lt;/id&gt;</span><br><span class="line">		&lt;property name="name"&gt;&lt;/property&gt;</span><br><span class="line">		&lt;property name="age"&gt;&lt;/property&gt;</span><br><span class="line">		&lt;property name="marryId"&gt;&lt;/property&gt;</span><br><span class="line">	  &lt;!-- 目的： 表达的是一对一的关系   </span><br><span class="line">	      many-to-one原本：多对一，使用unique=<span class="string">"true"</span>属性进行转化变成一对一</span><br><span class="line">	      column：声明一个外键，去连接另一个表  (值随意定义，见名之意)</span><br><span class="line">	      --&gt;</span><br><span class="line">	  &lt;many-to-one name="wife" unique="true" column="wife_id1"&gt;&lt;/many-to-one&gt;  </span><br><span class="line">	&lt;/class&gt;</span><br><span class="line">&lt;/hibernate-mapping&gt;</span><br></pre></td></tr></table></figure>
<h6 id="Wife-hbm-xml-1"><a href="#Wife-hbm-xml-1" class="headerlink" title="Wife.hbm.xml"></a>Wife.hbm.xml</h6><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span>?&gt;</span><br><span class="line">&lt;!DOCTYPE hibernate-mapping PUBLIC </span><br><span class="line">    <span class="string">"-//Hibernate/Hibernate Mapping DTD 3.0//EN"</span></span><br><span class="line">    <span class="string">"http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd"</span>&gt;</span><br><span class="line">    &lt;hibernate-mapping <span class="keyword">package</span>=<span class="string">"com.qf.domain"</span>&gt;</span><br><span class="line">	&lt;<span class="class"><span class="keyword">class</span> <span class="title">name</span></span>=<span class="string">"Wife"</span> table=<span class="string">"wife"</span>&gt;</span><br><span class="line">		&lt;id name=<span class="string">"wid"</span>&gt;</span><br><span class="line">			&lt;generator class="native"&gt;&lt;/generator&gt;</span><br><span class="line">		&lt;/id&gt;</span><br><span class="line">		&lt;property name="name"&gt;&lt;/property&gt;</span><br><span class="line">		&lt;property name="age"&gt;&lt;/property&gt;</span><br><span class="line">		&lt;property name="marryId"&gt;&lt;/property&gt;</span><br><span class="line">	  &lt;!-- 表达一对一的关系：</span><br><span class="line">	      当前Wife和name变量代指的类映射的表建立一对一的关系。 --&gt;</span><br><span class="line">	   &lt;one-to-one name="husband"&gt;&lt;/one-to-one&gt;</span><br><span class="line">	&lt;/class&gt;</span><br><span class="line"></span><br><span class="line">&lt;/hibernate-mapping&gt;</span><br></pre></td></tr></table></figure>
<h5 id="1-2-3-测试"><a href="#1-2-3-测试" class="headerlink" title="1.2.3 测试"></a>1.2.3 测试</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test01</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		Session session = HibernateUtils.getCurrentSession();</span><br><span class="line">		Transaction transaction = session.beginTransaction();</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">		   Husband husband =<span class="keyword">new</span> Husband();</span><br><span class="line">			husband.setName(<span class="string">"丈夫1"</span>);</span><br><span class="line">			</span><br><span class="line">			Wife wife =<span class="keyword">new</span> Wife();</span><br><span class="line">			wife.setName(<span class="string">"妻子1"</span>);</span><br><span class="line">			</span><br><span class="line">			<span class="comment">//表达一对一的关系</span></span><br><span class="line">			husband.setWife(wife);			</span><br><span class="line"> 		    wife.setHusband(husband);</span><br><span class="line">			</span><br><span class="line">			</span><br><span class="line">			<span class="comment">//有约束关系的表后插入(该表插入的时候要 找对应的关系的那条数据)</span></span><br><span class="line">			<span class="comment">//先插入主表</span></span><br><span class="line">			session.save(wife);</span><br><span class="line">			<span class="comment">//后插入副表</span></span><br><span class="line">			session.save(husband);</span><br><span class="line">			</span><br><span class="line">			transaction.commit();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			<span class="comment">// <span class="doctag">TODO:</span> handle exception</span></span><br><span class="line">			<span class="keyword">if</span> (transaction!=<span class="keyword">null</span>) &#123;</span><br><span class="line">				transaction.rollback();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-一对多-多对一（最常用，重点）"><a href="#2-一对多-多对一（最常用，重点）" class="headerlink" title="2.一对多|多对一（最常用，重点）"></a>2.一对多|多对一（最常用，重点）</h3><p>示例：客户和联系人为例：</p>
<p>一对多： 一个客户对应多个联系人</p>
<p>多对一：多个联系人对应一个客户</p>
<h4 id="2-1-持久化类"><a href="#2-1-持久化类" class="headerlink" title="2.1 持久化类"></a>2.1 持久化类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.qf.domain;</span><br><span class="line"></span><br><span class="line"><span class="comment">//从表(拥有外键。)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Contact</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> Integer contact_id; <span class="comment">//主键</span></span><br><span class="line"><span class="keyword">private</span> String contact_name;</span><br><span class="line"><span class="keyword">private</span> Integer contact_cust_id;<span class="comment">//外键(表达关系的时候声明外键即可)</span></span><br><span class="line"><span class="keyword">private</span> String contact_gender;</span><br><span class="line"><span class="keyword">private</span> String contact_phone;</span><br><span class="line"><span class="keyword">private</span> String contact_mobile;</span><br><span class="line"><span class="keyword">private</span> String contact_email;</span><br><span class="line"><span class="keyword">private</span> String contact_qq;</span><br><span class="line"><span class="keyword">private</span> String contact_position;</span><br><span class="line"><span class="keyword">private</span> String contact_memo;<span class="comment">//备注</span></span><br><span class="line"><span class="comment">//表达多(Contact)对一(Customer)关系</span></span><br><span class="line"><span class="keyword">private</span> Customer customer;</span><br><span class="line">set/get.....</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.qf.domain;</span><br><span class="line"><span class="keyword">import</span> java.util.HashSet;</span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"><span class="comment">//主表</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Customer</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Integer  cust_id;<span class="comment">//主键</span></span><br><span class="line">	<span class="keyword">private</span> String  cust_name;</span><br><span class="line">	<span class="keyword">private</span> Integer  cust_user_id;</span><br><span class="line">	<span class="keyword">private</span> Integer  cust_create_id;</span><br><span class="line">	<span class="keyword">private</span> String  cust_source;</span><br><span class="line">	<span class="keyword">private</span> String  cust_industry;</span><br><span class="line">	<span class="keyword">private</span> String  cust_level;</span><br><span class="line">	<span class="keyword">private</span> String  cust_linkman;</span><br><span class="line">	<span class="keyword">private</span> String  cust_phone;</span><br><span class="line">	<span class="keyword">private</span> String  cust_mobile;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//表达一(Customer)对多(Contact)的关系</span></span><br><span class="line">	<span class="keyword">private</span> Set&lt;Contact&gt; contacts =<span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line">	set/get.....</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-2-映射文件"><a href="#2-2-映射文件" class="headerlink" title="2.2 映射文件"></a>2.2 映射文件</h4><h5 id="Contact-hbm-xml"><a href="#Contact-hbm-xml" class="headerlink" title="Contact.hbm.xml"></a>Contact.hbm.xml</h5><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span>?&gt;</span><br><span class="line">&lt;!DOCTYPE hibernate-mapping PUBLIC </span><br><span class="line">    <span class="string">"-//Hibernate/Hibernate Mapping DTD 3.0//EN"</span></span><br><span class="line">    <span class="string">"http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd"</span>&gt;</span><br><span class="line">&lt;hibernate-mapping <span class="keyword">package</span>=<span class="string">"com.qf.domain"</span>&gt;</span><br><span class="line">	&lt;<span class="class"><span class="keyword">class</span> <span class="title">name</span></span>=<span class="string">"Contact"</span> table=<span class="string">"contact"</span>&gt;</span><br><span class="line">		&lt;id name=<span class="string">"contact_id"</span>&gt;</span><br><span class="line">			&lt;generator class="native"&gt;&lt;/generator&gt;</span><br><span class="line">		&lt;/id&gt;</span><br><span class="line">		&lt;property name="contact_name" &gt;&lt;/property&gt;</span><br><span class="line">		&lt;property name="contact_gender" &gt;&lt;/property&gt;</span><br><span class="line">		&lt;property name="contact_phone" &gt;&lt;/property&gt;</span><br><span class="line">		&lt;property name="contact_mobile" &gt;&lt;/property&gt;</span><br><span class="line">		&lt;property name="contact_email" &gt;&lt;/property&gt;</span><br><span class="line">		&lt;property name="contact_qq" &gt;&lt;/property&gt;</span><br><span class="line">		&lt;property name="contact_position" &gt;&lt;/property&gt;</span><br><span class="line">		&lt;property name="contact_memo" &gt;&lt;/property&gt;</span><br><span class="line">		</span><br><span class="line">		&lt;!-- 表达多对一关系</span><br><span class="line">		 column:声明外键--&gt;</span><br><span class="line">		&lt;many-to-one name="customer" column="contact_cust_id"&gt;&lt;/many-to-one&gt;	</span><br><span class="line">	&lt;/class&gt;</span><br><span class="line">&lt;/hibernate-mapping&gt;</span><br></pre></td></tr></table></figure>
<h5 id="Customer-hbm-xml"><a href="#Customer-hbm-xml" class="headerlink" title="Customer.hbm.xml"></a>Customer.hbm.xml</h5><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span>?&gt;</span><br><span class="line">&lt;!DOCTYPE hibernate-mapping PUBLIC </span><br><span class="line">    <span class="string">"-//Hibernate/Hibernate Mapping DTD 3.0//EN"</span></span><br><span class="line">    <span class="string">"http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd"</span>&gt;</span><br><span class="line">&lt;hibernate-mapping <span class="keyword">package</span>=<span class="string">"com.qf.domain"</span>&gt;</span><br><span class="line">	&lt;<span class="class"><span class="keyword">class</span> <span class="title">name</span></span>=<span class="string">"Customer"</span> table=<span class="string">"customer"</span>&gt;</span><br><span class="line">		&lt;id name=<span class="string">"cust_id"</span> column=<span class="string">"cust_id"</span>&gt;</span><br><span class="line">			&lt;generator class="native"&gt;&lt;/generator&gt;</span><br><span class="line">		&lt;/id&gt;</span><br><span class="line">		&lt;property name="cust_name" column="cust_name"&gt;&lt;/property&gt;</span><br><span class="line">		&lt;property name="cust_user_id" column="cust_user_id"&gt;&lt;/property&gt;</span><br><span class="line">		&lt;property name="cust_create_id" column="cust_create_id"&gt;&lt;/property&gt;</span><br><span class="line">		&lt;property name="cust_source" column="cust_source"&gt;&lt;/property&gt;</span><br><span class="line">		&lt;property name="cust_industry" column="cust_industry"&gt;&lt;/property&gt;</span><br><span class="line">		&lt;property name="cust_level" column="cust_level"&gt;&lt;/property&gt;</span><br><span class="line">		&lt;property name="cust_linkman" column="cust_linkman"&gt;&lt;/property&gt;</span><br><span class="line">		&lt;property name="cust_phone" column="cust_phone"&gt;&lt;/property&gt;</span><br><span class="line">		&lt;property name="cust_mobile" column="cust_mobile"&gt;&lt;/property&gt;	</span><br><span class="line">	    &lt;!-- 表达一对多的关系 --&gt;</span><br><span class="line">	     &lt;set name=<span class="string">"contacts"</span>&gt;</span><br><span class="line">	        &lt;!-- column外键：说明哪一个外键要连接当前的表 --&gt;</span><br><span class="line">	       &lt;key column="contact_cust_id"&gt;&lt;/key&gt;</span><br><span class="line">	       &lt;!-- 表达关系 --&gt;</span><br><span class="line">	       &lt;one-to-many <span class="class"><span class="keyword">class</span></span>=<span class="string">"Contact"</span>/&gt;</span><br><span class="line">	     &lt;/set&gt;</span><br><span class="line">	&lt;/class&gt;</span><br><span class="line">&lt;/hibernate-mapping&gt;</span><br></pre></td></tr></table></figure>
<h4 id="2-3-主配置文件"><a href="#2-3-主配置文件" class="headerlink" title="2.3 主配置文件"></a>2.3 主配置文件</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span>?&gt;</span><br><span class="line">&lt;!DOCTYPE hibernate-configuration PUBLIC</span><br><span class="line">	<span class="string">"-//Hibernate/Hibernate Configuration DTD 3.0//EN"</span></span><br><span class="line">	<span class="string">"http://www.hibernate.org/dtd/hibernate-configuration-3.0.dtd"</span>&gt;</span><br><span class="line">&lt;!-- <span class="number">4</span>(数据库信息)+<span class="number">1</span>(数据库方言)+<span class="number">2</span>(生成sql格式化并打印)+<span class="number">1</span>(数据库表生成策略)+<span class="number">1</span>(加载映射文件)+</span><br><span class="line"><span class="number">1</span>(事务隔离级别)+<span class="number">1</span>(配置current_session_context) --&gt;	</span><br><span class="line">&lt;hibernate-configuration&gt;</span><br><span class="line">&lt;session-factory&gt;</span><br><span class="line">  &lt;property name="hibernate.connection.driver_class"&gt;com.mysql.jdbc.Driver&lt;/property&gt;</span><br><span class="line">  &lt;property name=<span class="string">"hibernate.connection.url"</span>&gt;jdbc:mysql:<span class="comment">//localhost:3306/1715_hibernate05&lt;/property&gt;</span></span><br><span class="line">  &lt;property name="hibernate.connection.username"&gt;root&lt;/property&gt;</span><br><span class="line">  &lt;property name="hibernate.connection.password"&gt;123456&lt;/property&gt;</span><br><span class="line">  </span><br><span class="line"> &lt;!-- JBoss Tools 提示工具 --&gt;</span><br><span class="line">  &lt;property name="hibernate.dialect"&gt;org.hibernate.dialect.MySQL5InnoDBDialect&lt;/property&gt;</span><br><span class="line">  </span><br><span class="line">  &lt;property name="hibernate.show_sql"&gt;true&lt;/property&gt;</span><br><span class="line">  &lt;property name="hibernate.format_sql"&gt;true&lt;/property&gt;</span><br><span class="line">  </span><br><span class="line">  &lt;property name="hibernate.hbm2ddl.auto"&gt;update&lt;/property&gt;</span><br><span class="line">    &lt;!-- 隔离级别 --&gt;</span><br><span class="line">  &lt;property name="hibernate.connection.isolation"&gt;4&lt;/property&gt;</span><br><span class="line">         </span><br><span class="line">  &lt;!-- 目的：要使用getCurrentSession()获取当前线程绑定的Session，必须要做如下配置：--&gt;</span><br><span class="line">  &lt;property name="hibernate.current_session_context_class"&gt;thread&lt;/property&gt;</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  &lt;mapping resource=<span class="string">"com/qf/domain/Customer.hbm.xml"</span>/&gt;</span><br><span class="line">  &lt;mapping resource=<span class="string">"com/qf/domain/Contact.hbm.xml"</span>/&gt;</span><br><span class="line">&lt;/session-factory&gt;</span><br><span class="line"></span><br><span class="line">&lt;/hibernate-configuration&gt;</span><br></pre></td></tr></table></figure>
<h4 id="2-4-测试"><a href="#2-4-测试" class="headerlink" title="2.4 测试"></a>2.4 测试</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test001</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		 Session session = HibernateUtils.getCurrentSession();</span><br><span class="line">		 Transaction transaction =  session.beginTransaction();</span><br><span class="line">		 <span class="keyword">try</span> &#123;</span><br><span class="line">			  <span class="comment">//1个客户</span></span><br><span class="line">			 Customer customer= <span class="keyword">new</span> Customer();</span><br><span class="line">			 customer.setCust_name(<span class="string">"阿里巴巴"</span>);</span><br><span class="line">			 </span><br><span class="line">			 </span><br><span class="line">			 <span class="comment">//多个联系人，示例2个</span></span><br><span class="line">			 Contact contact1 =<span class="keyword">new</span> Contact();</span><br><span class="line">			 contact1.setContact_name(<span class="string">"马云"</span>);</span><br><span class="line">			 Contact contact2 =<span class="keyword">new</span> Contact();</span><br><span class="line">			 contact2.setContact_name(<span class="string">"李总"</span>);</span><br><span class="line">			 </span><br><span class="line">			 <span class="comment">//表达多表关系</span></span><br><span class="line">			 <span class="comment">//一对多</span></span><br><span class="line">			 <span class="comment">//把联系人给客户添加上</span></span><br><span class="line">			 customer.getContacts().add(contact1);</span><br><span class="line">			 customer.getContacts().add(contact2);</span><br><span class="line">			 </span><br><span class="line">			 <span class="comment">//多对一</span></span><br><span class="line">			 contact1.setCustomer(customer);</span><br><span class="line">			 contact2.setCustomer(customer);</span><br><span class="line">			 </span><br><span class="line">			 </span><br><span class="line">			 <span class="comment">//持久化保存</span></span><br><span class="line">			  session.save(customer);</span><br><span class="line">			  session.save(contact1);</span><br><span class="line">			  session.save(contact2);</span><br><span class="line">			 </span><br><span class="line">			 </span><br><span class="line">			 transaction.commit();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			<span class="comment">// <span class="doctag">TODO:</span> handle exception</span></span><br><span class="line">			<span class="keyword">if</span> (transaction!=<span class="keyword">null</span>) &#123;</span><br><span class="line">				transaction.rollback();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//给指定客户添加新的联系</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">//持久态的对象会自动更新，已经在数据库中</span></span><br><span class="line">	<span class="comment">//瞬时状态和游离状态必须通过方法转化成持久态才可以保存到数据</span></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test002</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		 Session session = HibernateUtils.getCurrentSession();</span><br><span class="line">		 Transaction transaction =  session.beginTransaction();</span><br><span class="line">		 <span class="keyword">try</span> &#123;</span><br><span class="line">		     <span class="comment">//1.先找出客户</span></span><br><span class="line">			 Customer customer = session.get(Customer.class, <span class="number">1</span>);</span><br><span class="line">			</span><br><span class="line">			 <span class="comment">//2.新加联系人</span></span><br><span class="line">			 Contact contact =<span class="keyword">new</span> Contact();</span><br><span class="line">			 contact.setContact_name(<span class="string">"刘总"</span>);</span><br><span class="line">			 </span><br><span class="line">			 <span class="comment">//表达一对多的关系</span></span><br><span class="line">			 customer.getContacts().add(contact);</span><br><span class="line">			 </span><br><span class="line">			 <span class="comment">//表达多对一的关系</span></span><br><span class="line">			 contact.setCustomer(customer);</span><br><span class="line">			 </span><br><span class="line">			 <span class="comment">//保存</span></span><br><span class="line">			 session.save(contact);</span><br><span class="line">			 </span><br><span class="line">			 transaction.commit();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			<span class="comment">// <span class="doctag">TODO:</span> handle exception</span></span><br><span class="line">			<span class="keyword">if</span> (transaction!=<span class="keyword">null</span>) &#123;</span><br><span class="line">				transaction.rollback();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<h2 id="3-多对多："><a href="#3-多对多：" class="headerlink" title="3.多对多："></a>3.多对多：</h2><p>示例1：多个学生可以被多个老师教，多个老师可以教多个 学生；</p>
<p>示例2：多个用户可以有多个角色，多个角色可以有多个用户。</p>
<p>​            例如:马云既是老板又是演员。李彦宏既是企业家又是老板。</p>
<h4 id="1-User-java"><a href="#1-User-java" class="headerlink" title="1.User.java"></a>1.User.java</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Integer user_id;</span><br><span class="line">	<span class="keyword">private</span> String user_name;</span><br><span class="line">	<span class="keyword">private</span> String user_pwd;</span><br><span class="line">	<span class="keyword">private</span> String user_state;<span class="comment">//用户状态</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">//表达User和Role的多对多的关系</span></span><br><span class="line">	<span class="keyword">private</span> Set&lt;Role&gt; roles =<span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line">     set/get.......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-Role-java"><a href="#2-Role-java" class="headerlink" title="2.Role.java"></a>2.Role.java</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Role</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Integer role_id;<span class="comment">//角色编号</span></span><br><span class="line">	<span class="keyword">private</span> String role_name;<span class="comment">//角色名</span></span><br><span class="line">	<span class="keyword">private</span> String role_memo;<span class="comment">//角色备注</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">//表达Role和User的多对多的关系</span></span><br><span class="line">	<span class="keyword">private</span> Set&lt;User&gt; users =<span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line">    set/get.......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="3-User-hbm-xml"><a href="#3-User-hbm-xml" class="headerlink" title="3.User.hbm.xml"></a>3.User.hbm.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br><span class="line"><span class="meta">&lt;!DOCTYPE hibernate-mapping PUBLIC </span></span><br><span class="line"><span class="meta">    "-//Hibernate/Hibernate Mapping DTD 3.0//EN"</span></span><br><span class="line"><span class="meta">    "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd"&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">hibernate-mapping</span> <span class="attr">package</span>=<span class="string">"com.qf.domain"</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"User"</span> <span class="attr">table</span>=<span class="string">"user"</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"user_id"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"native"</span>&gt;</span><span class="tag">&lt;/<span class="name">generator</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"user_name"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"user_pwd"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"user_state"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">   </span><br><span class="line">   <span class="comment">&lt;!-- 表达多对多的关系  table:表示中间表的名称 </span></span><br><span class="line"><span class="comment">      inverse:true  不维护关系(放弃维护关系)</span></span><br><span class="line"><span class="comment">              false:默认false，维护关系</span></span><br><span class="line"><span class="comment">      --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">set</span> <span class="attr">name</span>=<span class="string">"roles"</span> <span class="attr">table</span>=<span class="string">"user_role"</span> <span class="attr">inverse</span>=<span class="string">"true"</span> &gt;</span></span><br><span class="line">      <span class="comment">&lt;!--  引用已经存在的键连接当前表User--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">key</span> <span class="attr">column</span>=<span class="string">"user_id1"</span>&gt;</span><span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">     <span class="comment">&lt;!-- class:与当前表要建立关系的实体类名称</span></span><br><span class="line"><span class="comment">          column:声明外键.表示在中间表中生成一个新的列。</span></span><br><span class="line"><span class="comment">                                 作为外键去连接与当前表要建立关系的表</span></span><br><span class="line"><span class="comment">          --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">many-to-many</span> <span class="attr">class</span>=<span class="string">"Role"</span> <span class="attr">column</span>=<span class="string">"role_id1"</span>&gt;</span><span class="tag">&lt;/<span class="name">many-to-many</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"> <span class="tag">&lt;/<span class="name">hibernate-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="4-Role-hbm-xml"><a href="#4-Role-hbm-xml" class="headerlink" title="4.Role.hbm.xml"></a>4.Role.hbm.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br><span class="line"><span class="meta">&lt;!DOCTYPE hibernate-mapping PUBLIC </span></span><br><span class="line"><span class="meta">    "-//Hibernate/Hibernate Mapping DTD 3.0//EN"</span></span><br><span class="line"><span class="meta">    "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd"&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">hibernate-mapping</span> <span class="attr">package</span>=<span class="string">"com.qf.domain"</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"Role"</span> <span class="attr">table</span>=<span class="string">"role"</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"role_id"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"native"</span>&gt;</span><span class="tag">&lt;/<span class="name">generator</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"role_name"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"role_memo"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">   </span><br><span class="line">   <span class="comment">&lt;!-- 表达多对多的关系  table:表示中间表的名称 --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">set</span> <span class="attr">name</span>=<span class="string">"users"</span> <span class="attr">table</span>=<span class="string">"user_role"</span>  &gt;</span></span><br><span class="line">      <span class="comment">&lt;!--  引用已经存在的键连接当前表Role--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">key</span> <span class="attr">column</span>=<span class="string">"role_id1"</span>&gt;</span><span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">     <span class="comment">&lt;!-- class:与当前表要建立关系的实体类名称</span></span><br><span class="line"><span class="comment">          column:声明外键.表示在中间表中生成一个新的列。</span></span><br><span class="line"><span class="comment">                                 作为外键去连接与当前表要建立关系的表</span></span><br><span class="line"><span class="comment">          --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">many-to-many</span> <span class="attr">class</span>=<span class="string">"User"</span> <span class="attr">column</span>=<span class="string">"user_id1"</span>&gt;</span><span class="tag">&lt;/<span class="name">many-to-many</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"> <span class="tag">&lt;/<span class="name">hibernate-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="5-hibernate-cfg-xml"><a href="#5-hibernate-cfg-xml" class="headerlink" title="5.hibernate.cfg.xml"></a>5.hibernate.cfg.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br><span class="line"><span class="meta">&lt;!DOCTYPE hibernate-configuration PUBLIC</span></span><br><span class="line"><span class="meta">	"-//Hibernate/Hibernate Configuration DTD 3.0//EN"</span></span><br><span class="line"><span class="meta">	"http://www.hibernate.org/dtd/hibernate-configuration-3.0.dtd"&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 4(数据库信息)+1(数据库方言)+2(生成sql格式化并打印)+1(数据库表生成策略)+1(加载映射文件)+</span></span><br><span class="line"><span class="comment">1(事务隔离级别)+1(配置current_session_context) --&gt;</span>	</span><br><span class="line"><span class="tag">&lt;<span class="name">hibernate-configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">session-factory</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.driver_class"</span>&gt;</span>com.mysql.jdbc.Driver<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.url"</span>&gt;</span>jdbc:mysql://localhost:3306/1715_hibernate06<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.username"</span>&gt;</span>root<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.password"</span>&gt;</span>123456<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  </span><br><span class="line"> <span class="comment">&lt;!-- JBoss Tools 提示工具 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.dialect"</span>&gt;</span>org.hibernate.dialect.MySQL5InnoDBDialect<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.show_sql"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.format_sql"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.hbm2ddl.auto"</span>&gt;</span>update<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 隔离级别 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.isolation"</span>&gt;</span>4<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">         </span><br><span class="line">  <span class="comment">&lt;!-- 目的：要使用getCurrentSession()获取当前线程绑定的Session，必须要做如下配置：--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.current_session_context_class"</span>&gt;</span>thread<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;<span class="name">mapping</span> <span class="attr">resource</span>=<span class="string">"com/qf/domain/User.hbm.xml"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mapping</span> <span class="attr">resource</span>=<span class="string">"com/qf/domain/Role.hbm.xml"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">session-factory</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">hibernate-configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="6-测试"><a href="#6-测试" class="headerlink" title="6.测试"></a>6.测试</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">   <span class="comment">//插入</span></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test01</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		Session session =  HibernateUtils.getCurrentSession();</span><br><span class="line">		Transaction transaction = session.beginTransaction();</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			User user1 =<span class="keyword">new</span> User();</span><br><span class="line">			user1.setUser_name(<span class="string">"马云11111"</span>);</span><br><span class="line">			</span><br><span class="line">			User user2 =<span class="keyword">new</span> User();</span><br><span class="line">			user2.setUser_name(<span class="string">"李彦宏1111"</span>);</span><br><span class="line">					</span><br><span class="line">			Role role1 =<span class="keyword">new</span> Role();</span><br><span class="line">			role1.setRole_name(<span class="string">"企业家11111"</span>);</span><br><span class="line">			</span><br><span class="line">			</span><br><span class="line">			Role role2 =<span class="keyword">new</span> Role();</span><br><span class="line">			role2.setRole_name(<span class="string">"演员11111"</span>);	</span><br><span class="line">			</span><br><span class="line">			<span class="comment">//表达多对多的关系	</span></span><br><span class="line">			<span class="comment">//从user角度出发表达关系</span></span><br><span class="line">			user1.getRoles().add(role1);</span><br><span class="line">			user1.getRoles().add(role2);</span><br><span class="line">			</span><br><span class="line">			user2.getRoles().add(role1);</span><br><span class="line">			user2.getRoles().add(role2);</span><br><span class="line">			</span><br><span class="line">			</span><br><span class="line">			<span class="comment">//从role角度出发表达关系</span></span><br><span class="line">		    role1.getUsers().add(user1);</span><br><span class="line">			role1.getUsers().add(user2);</span><br><span class="line">			</span><br><span class="line">			role2.getUsers().add(user1);</span><br><span class="line">			role2.getUsers().add(user2);</span><br><span class="line">			</span><br><span class="line">			</span><br><span class="line">			session.save(user1);</span><br><span class="line">			session.save(user2);</span><br><span class="line">					</span><br><span class="line">			session.save(role1);</span><br><span class="line">			session.save(role2);</span><br><span class="line">			</span><br><span class="line">			transaction.commit();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			<span class="comment">// <span class="doctag">TODO:</span> handle exception</span></span><br><span class="line">			<span class="keyword">if</span> (transaction!=<span class="keyword">null</span>) &#123;</span><br><span class="line">				transaction.rollback();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">执行以上代码报错：约束异常。</span><br><span class="line">  解决方式一：去除掉一方关系表达维护，例如：删除掉<span class="number">30</span>-<span class="number">34</span>行代码</span><br><span class="line">  解决方式二：代码不用改变，在不需要维护关系的地方添加inverse=<span class="string">"true"</span>(谁放弃给谁加)</span><br><span class="line">            示例：User维护User和Role的关系。    Role放弃关系维护。</span><br><span class="line">      &lt;set name=<span class="string">"roles"</span> table=<span class="string">"user_role"</span> inverse=<span class="string">"true"</span> &gt;</span><br><span class="line">      &lt;!--  引用已经存在的键连接当前表User--&gt;</span><br><span class="line">      &lt;key column="user_id1"&gt;&lt;/key&gt;</span><br><span class="line">     &lt;!-- class:与当前表要建立关系的实体类名称</span><br><span class="line">          column:声明外键.表示在中间表中生成一个新的列。</span><br><span class="line">                                 作为外键去连接与当前表要建立关系的表</span><br><span class="line">          --&gt;</span><br><span class="line">     &lt;many-to-many class="Role" column="role_id1"&gt;&lt;/many-to-many&gt;</span><br><span class="line">     &lt;/set&gt;       </span><br><span class="line">            </span><br><span class="line">  备注：inverse</span><br><span class="line">               <span class="keyword">true</span>:放弃维护关系</span><br><span class="line">               <span class="keyword">false</span>:维护关系  ，默认</span><br></pre></td></tr></table></figure>
<h4 id="7-cascade级联操作-多表关系"><a href="#7-cascade级联操作-多表关系" class="headerlink" title="7.cascade级联操作(多表关系)"></a>7.cascade级联操作(多表关系)</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* cascade:级联操作   </span></span><br><span class="line"><span class="comment"> *       save-update(重点): 级联更新 .持久化当前对象的同时要持久化与之相关联的对象。</span></span><br><span class="line"><span class="comment"> *                   示例：session.save(User)  含义：持久化User的同时在持久化与User关联的类Role</span></span><br><span class="line"><span class="comment">               在以上案例中可以去除40行和41行</span></span><br><span class="line"><span class="comment"> *       delete: 级联删除    删除一个对象的同时会删除掉与之相关连的对象  (不建议使用，慎重使用)    </span></span><br><span class="line"><span class="comment"> *       all:  save-update和delete结合一起</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">	  <span class="comment">//删除用户(使用cascade="delete"会删除调用当前数据和与之关联的所有数据)</span></span><br><span class="line">		<span class="meta">@Test</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test02</span><span class="params">()</span> </span>&#123;</span><br><span class="line">			Session session =  HibernateUtils.getCurrentSession();</span><br><span class="line">			Transaction transaction = session.beginTransaction();</span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				 <span class="comment">//删除一个用户</span></span><br><span class="line">				User user = session.get(User.class, <span class="number">3</span>);</span><br><span class="line">				session.delete(user);<span class="comment">//删除user的同时删除了该user关联的role角色</span></span><br><span class="line">		</span><br><span class="line">				transaction.commit();</span><br><span class="line">			&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">				<span class="comment">// <span class="doctag">TODO:</span> handle exception</span></span><br><span class="line">				<span class="keyword">if</span> (transaction!=<span class="keyword">null</span>) &#123;</span><br><span class="line">					transaction.rollback();</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//给用户删除指定角色(不使用cascade="delete"删除)</span></span><br><span class="line">		<span class="meta">@Test</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test03</span><span class="params">()</span> </span>&#123;</span><br><span class="line">			Session session =  HibernateUtils.getCurrentSession();</span><br><span class="line">			Transaction transaction = session.beginTransaction();</span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				 <span class="comment">//一个用户</span></span><br><span class="line">				User user = session.get(User.class, <span class="number">5</span>);</span><br><span class="line">				<span class="comment">//给该用户删除一个角色</span></span><br><span class="line">				Role role= session.get(Role.class, <span class="number">6</span>);				</span><br><span class="line">			     <span class="comment">//从用户移除角色</span></span><br><span class="line">				user.getRoles().remove(role);<span class="comment">//内连接查询			</span></span><br><span class="line">				session.delete(role);	</span><br><span class="line">				transaction.commit();</span><br><span class="line">			&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">				<span class="comment">// <span class="doctag">TODO:</span> handle exception</span></span><br><span class="line">				<span class="keyword">if</span> (transaction!=<span class="keyword">null</span>) &#123;</span><br><span class="line">					transaction.rollback();</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br></pre></td></tr></table></figure>
<h1 id="Hibernate的优化："><a href="#Hibernate的优化：" class="headerlink" title="Hibernate的优化："></a>Hibernate的优化：</h1><h3 id="1-Hibernate配置数据源C3P0"><a href="#1-Hibernate配置数据源C3P0" class="headerlink" title="1.Hibernate配置数据源C3P0"></a>1.Hibernate配置数据源C3P0</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>.导入C3P0包(hibernate提供的。 hibernate的下载库\lib\optional\c3p0\xx.jar(<span class="number">3</span>个))</span><br><span class="line"><span class="number">2</span>.给主配置文件(hibernate.cfg.xml)配置数据源连接池</span><br><span class="line">  &lt;!-- 设置C3P0数据源 --&gt;</span><br><span class="line">  &lt;!-- 配置Hibernate提供的C3P0数据源的类 --&gt;</span><br><span class="line">&lt;property name=<span class="string">"hibernate.connection.provider_class"</span>&gt;</span><br><span class="line">            org.hibernate.c3p0.internal.C3P0ConnectionProvider&lt;/property&gt;</span><br><span class="line">  &lt;!-- 额外配置。一般配置 c3p0.max_size和c3p0.min_size--&gt;</span><br><span class="line">  &lt;property name="c3p0.max_size"&gt;100&lt;/property&gt;</span><br><span class="line">  &lt;property name="c3p0.min_size"&gt;10&lt;/property&gt;</span><br><span class="line">  &lt;property name="c3p0.max_statements"&gt;200&lt;/property&gt;</span><br><span class="line">  &lt;property name="c3p0.timeout"&gt;30000&lt;/property&gt;</span><br><span class="line">  &lt;property name="c3p0.idle_test_period"&gt;30&lt;/property&gt;</span><br><span class="line"><span class="number">3</span>.测试(查看连接是否是c3p0连接池提供的)</span><br><span class="line">   <span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test001</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		Session session = HibernateUtils.getCurrentSession();</span><br><span class="line">		Transaction transaction = session.beginTransaction();</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			session.doWork(<span class="keyword">new</span> Work() &#123;</span><br><span class="line">				</span><br><span class="line">				<span class="meta">@Override</span></span><br><span class="line">				<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">(Connection arg0)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">					<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">					<span class="comment">//1.hibernate的Connection是jdbc提供的。com.mysql.jdbc......</span></span><br><span class="line">                      <span class="comment">//2.配置了c3p0后，connection是从c3p0提供的。</span></span><br><span class="line">                      <span class="comment">//示例： com.mchange.v2.c3p0.impl.NewProxyConnection@30cdae70 </span></span><br><span class="line">					System.out.println(arg0);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;);</span><br><span class="line">			transaction.commit();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			<span class="comment">// <span class="doctag">TODO:</span> handle exception</span></span><br><span class="line">			<span class="keyword">if</span> (transaction!=<span class="keyword">null</span>) &#123;</span><br><span class="line">				transaction.rollback();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-Hibernate延迟加载-类级别给class添加lazy"><a href="#2-Hibernate延迟加载-类级别给class添加lazy" class="headerlink" title="2.Hibernate延迟加载(类级别给class添加lazy)"></a>2.Hibernate延迟加载(类级别给class添加lazy)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">lazy：是否延迟加载</span><br><span class="line">     <span class="keyword">true</span>:延迟加载</span><br><span class="line">     <span class="keyword">false</span>:立即加载</span><br><span class="line">     </span><br><span class="line">示例：session.find(T.classs,id) 立即加载</span><br><span class="line">     session.get(T.classs,id)   立即加载</span><br><span class="line">     session.load(T.classs,id)   默认延迟加载  lazy=<span class="keyword">false</span>: 立即加载，lazy=<span class="keyword">true</span>:延迟加载</span><br><span class="line"> </span><br><span class="line"> 延迟加载： 查询某个对象，只有在使用的时候才会发起sql语句执行(执行load()不会发起sql语句)</span><br><span class="line"> 不延迟加载：执行get()/load()/find()直接发起sql语句执行，不管有没有用到该对象。</span><br><span class="line"> </span><br><span class="line"> 结论：为了提高效率，建议使用延迟加载策略</span><br></pre></td></tr></table></figure>
<h3 id="3-关联级别策略"><a href="#3-关联级别策略" class="headerlink" title="3.关联级别策略"></a>3.关联级别策略</h3><h4 id="3-1-集合策略-元数据配置文件中set标签添加"><a href="#3-1-集合策略-元数据配置文件中set标签添加" class="headerlink" title="3.1 集合策略(元数据配置文件中set标签添加)"></a>3.1 集合策略(元数据配置文件中set标签添加)</h4><pre><code>查询有关联关系的数据时，加载一方的数据决定是否要将另一方的数据进行加载。
</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 以下效果一定要用断点调试debug查看：F5进入方法查看，F6下一步</span></span><br><span class="line"><span class="comment">	 * 集合加载策略(给元数据配置中的set标签添加)：</span></span><br><span class="line"><span class="comment">	 * lazy</span></span><br><span class="line"><span class="comment">	 *   1.true: (默认)延迟加载。先查询一方数据，后查询另一方数据(如果要大小查的是整个表的数据)。</span></span><br><span class="line"><span class="comment">	 *   2.extra:极其懒惰。先查询一方数据，后需要查询什么就执行什么</span></span><br><span class="line"><span class="comment">	 *       	(示例：例如，只要另一方的大小，只执行select count(*) from 表名)</span></span><br><span class="line"><span class="comment">	 *       	紧接着：如果需要使用内容了才查询内容。     </span></span><br><span class="line"><span class="comment">	 *   3.false:立即加载。查询一方数据的同时查询了另一方的数据(单表操作)</span></span><br><span class="line"><span class="comment">	 * </span></span><br><span class="line"><span class="comment">	 * 抓取策略：</span></span><br><span class="line"><span class="comment">	 *  fetch:使用什么类型的sql语句进行查询加载</span></span><br><span class="line"><span class="comment">	 *    1. select:表示单表操作。默认单表操作。 (单表操作)</span></span><br><span class="line"><span class="comment">	 *    2. join：多表连接查询，默认使用左外连接查询。 lazy属性无效.  (左外连接)</span></span><br><span class="line"><span class="comment">	 *           查询一方的时候，使用了左外连接同时查询当前表和与之关联的表。</span></span><br><span class="line"><span class="comment">	 *         例如：select.... from user left outer join role left outer join user_role.....</span></span><br><span class="line"><span class="comment">	 *         整个过程发起一次sql语句。(但是会扫描所有表)</span></span><br><span class="line"><span class="comment">	 *     </span></span><br><span class="line"><span class="comment">	 *    3. subselect：子查询。先查询当前表后查询子表。 (内连接)</span></span><br><span class="line"><span class="comment">	 *     lazy=extra:  先查询User表，到求Role的大小，</span></span><br><span class="line"><span class="comment">	 *                  只查询count(*),后查询Role的数据时，采用了内连接(Role连接user_role中间表)</span></span><br><span class="line"><span class="comment">	 *     lazy=true:先查询User表，到求Role的大小，采用了内连接(Role连接user_role中间表)查询</span></span><br><span class="line"><span class="comment">	 *               后续只需要去结果 </span></span><br><span class="line"><span class="comment">	 *     lazy=false:查询User表的同时，采用了内连接(Role连接user_role中间表)查询,后续只需要取结果</span></span><br><span class="line"><span class="comment">	 * </span></span><br><span class="line"><span class="comment">     *  以后采用的策略：</span></span><br><span class="line"><span class="comment">	 *  Hibernate</span></span><br><span class="line"><span class="comment">	 *    常见： lazy=true,fetch=select</span></span><br><span class="line"><span class="comment">	 *   面试：编码中使用</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test02</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		Session session =  HibernateUtils.getCurrentSession();</span><br><span class="line">		Transaction transaction = session.beginTransaction();</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="comment">//1.先查询User</span></span><br><span class="line">			 User user =session.get(User.class, <span class="number">1</span>);</span><br><span class="line">			<span class="comment">//2.根据集合加载策略来查看Role的加载情况</span></span><br><span class="line">	        System.out.println(user);</span><br><span class="line">	        System.out.println(user.getRoles().size());</span><br><span class="line">	        System.out.println(user.getRoles());</span><br><span class="line">			transaction.commit();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			<span class="comment">// <span class="doctag">TODO:</span> handle exception</span></span><br><span class="line">			<span class="keyword">if</span> (transaction!=<span class="keyword">null</span>) &#123;</span><br><span class="line">				transaction.rollback();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<h4 id="3-2-关联属性策略-many-to-one添加lazy"><a href="#3-2-关联属性策略-many-to-one添加lazy" class="headerlink" title="3.2 关联属性策略(many-to-one添加lazy)"></a>3.2 关联属性策略(many-to-one添加lazy)</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">lazy:</span><br><span class="line">	proxy：采用关联对象的类级别加载策略决定</span><br><span class="line">	  重点：</span><br><span class="line">	     联系人     关联      客户</span><br><span class="line">	     先找联系人：后找客户。</span><br><span class="line">	    联系人立即获取客户，需要在Customer.hbm.xml中<span class="class"><span class="keyword">class</span>上添加<span class="title">lazy</span></span>=<span class="keyword">false</span></span><br><span class="line">	    联系人延迟获得客户，需要在Customer.hbm.xml中<span class="class"><span class="keyword">class</span>上添加<span class="title">lazy</span></span>=<span class="keyword">true</span>	</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">false</span>:立即加载</span><br><span class="line">	no-proxy:不学习(不研究)</span><br><span class="line">测试：</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 需求：先查询联系人，后根据属性加载策略来决定客户如何加载？</span></span><br><span class="line"><span class="comment">	 * </span></span><br><span class="line"><span class="comment">	 * 步骤：</span></span><br><span class="line"><span class="comment">	 *   1.给Contact.hbm.xml中many-to-one标签添加属性lazy=proxy</span></span><br><span class="line"><span class="comment">	 *   2.给Customer.hbm.xml中class标签添加</span></span><br><span class="line"><span class="comment">	 *      情况一：lazy=true:先单表查询Contact表，后才查询Customer表,</span></span><br><span class="line"><span class="comment">	 *             Customer是代理类。  </span></span><br><span class="line"><span class="comment">	 *      情况二：lazy=false:查询Contact表的同时查询Customer表(单表查询)</span></span><br><span class="line"><span class="comment">	 *             Customer是用户定义的类。</span></span><br><span class="line"><span class="comment">	 *   </span></span><br><span class="line"><span class="comment">	 * 持久化类不让final修饰，(因为后续中hibernate策略会用到动态代理,而动态代理需要继承这些持久化类)</span></span><br><span class="line"><span class="comment">	 *     final修饰的类不能继承，final修饰的变量不能修改，final修饰的方法不能被重写。</span></span><br><span class="line"><span class="comment">	 *                 </span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test001</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		 Session session = HibernateUtils.getCurrentSession();</span><br><span class="line">		 Transaction transaction =  session.beginTransaction();</span><br><span class="line">		 <span class="keyword">try</span> &#123;</span><br><span class="line">			  <span class="comment">//先找联系人</span></span><br><span class="line">			 Contact contact =session.get(Contact.class, <span class="number">1</span>);</span><br><span class="line">			 System.out.println(contact);</span><br><span class="line">			 <span class="comment">//查找客户</span></span><br><span class="line">			 System.out.println(contact.getCustomer()); 		 </span><br><span class="line">			 transaction.commit();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			<span class="comment">// <span class="doctag">TODO:</span> handle exception</span></span><br><span class="line">			<span class="keyword">if</span> (transaction!=<span class="keyword">null</span>) &#123;</span><br><span class="line">				transaction.rollback();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<h4 id="3-3-批量抓取batch-size"><a href="#3-3-批量抓取batch-size" class="headerlink" title="3.3 批量抓取batch-size"></a>3.3 批量抓取batch-size</h4><p>   一次性查询多少个数据( 条件where   列名  in  ( ?,?,?))</p>
<p>当batch-size大小超过了总的数据量，in后的？个数右总的数据量决定。</p>
<p>batch-size表示数据是一批一批的查询</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">从案例角度出发(Customer和Contact为例)：</span><br><span class="line">     Contact查询里面包含Customer的引用实例。如果遍历联系人Contact，就需要每次去发起sql语句查询Customer。次数多的化效率低。需要进行优化，需要batch-size(一次性获取多少个)</span><br><span class="line">  </span><br><span class="line">以下测试案例，在 Customer.hbm.xml 中<span class="class"><span class="keyword">class</span>上添加<span class="title">batch</span>-<span class="title">size</span>(一次性查询多少个数据)  </span></span><br><span class="line"><span class="class">   @<span class="title">Test</span></span></span><br><span class="line"><span class="class">	<span class="title">public</span> <span class="title">void</span> <span class="title">test002</span>() </span>&#123;</span><br><span class="line">		 Session session = HibernateUtils.getCurrentSession();</span><br><span class="line">		 Transaction transaction =  session.beginTransaction();</span><br><span class="line">		 <span class="keyword">try</span> &#123;</span><br><span class="line">			  <span class="comment">//查找所有联系人</span></span><br><span class="line">			Query&lt;Contact&gt; query = session.createQuery(<span class="string">"from com.qf.domain.Contact"</span>,Contact.class);</span><br><span class="line">			 List&lt;Contact&gt; list =query.list();</span><br><span class="line">			   <span class="keyword">int</span> size = list.size();</span><br><span class="line">			 <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line">				 Contact contact = list.get(i);</span><br><span class="line">				<span class="comment">//查找客户</span></span><br><span class="line">				 System.out.println(contact.getCustomer()); </span><br><span class="line">			&#125;			 </span><br><span class="line">			 transaction.commit();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			<span class="comment">// <span class="doctag">TODO:</span> handle exception</span></span><br><span class="line">			<span class="keyword">if</span> (transaction!=<span class="keyword">null</span>) &#123;</span><br><span class="line">				transaction.rollback();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<h1 id="Hibernate注解式开发"><a href="#Hibernate注解式开发" class="headerlink" title="Hibernate注解式开发"></a>Hibernate注解式开发</h1><h3 id="1-单表映射"><a href="#1-单表映射" class="headerlink" title="1.单表映射"></a>1.单表映射</h3><h3 id="2-多表映射"><a href="#2-多表映射" class="headerlink" title="2.多表映射"></a>2.多表映射</h3><p>​     备注：所有使用<strong><em><u>注解映射的类</u></em></strong>加载必须在主配置使用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;mapping class=&quot;包名+类名&quot;&gt; &lt;/mapping&gt;</span><br></pre></td></tr></table></figure>
<h4 id="2-1-一对一"><a href="#2-1-一对一" class="headerlink" title="2.1 一对一"></a>2.1 一对一</h4><h5 id="2-1-1-按照主键映射"><a href="#2-1-1-按照主键映射" class="headerlink" title="2.1.1 按照主键映射"></a>2.1.1 按照主键映射</h5><p>​          Husband.java  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table</span>(name=<span class="string">"husband"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Husband</span> </span>&#123;</span><br><span class="line">   <span class="meta">@Id</span></span><br><span class="line">   <span class="meta">@GeneratedValue</span>(strategy=GenerationType.IDENTITY)</span><br><span class="line">	<span class="keyword">private</span> Integer marryId;</span><br><span class="line">   <span class="meta">@Column</span></span><br><span class="line">	<span class="keyword">private</span> String h_name;</span><br><span class="line">   <span class="meta">@Column</span></span><br><span class="line">	<span class="keyword">private</span> Integer h_age;</span><br><span class="line">	<span class="comment">//表达一对一的关系</span></span><br><span class="line">   <span class="comment">//optional=false:表示关系一定存在，而且是当前类映射的表的主键要作为外键去连接相关连的表</span></span><br><span class="line">    <span class="meta">@OneToOne</span>(optional=<span class="keyword">false</span>) <span class="comment">//表示关系一定存在</span></span><br><span class="line">    <span class="meta">@PrimaryKeyJoinColumn</span> <span class="comment">//配置共享主键(两个主键的值是共享的，是一样的。)</span></span><br><span class="line">	<span class="keyword">private</span> Wife wife;</span><br><span class="line">	set/get....</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>​           Wife.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table</span>(name=<span class="string">"wife"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Wife</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue</span>(strategy=GenerationType.IDENTITY)</span><br><span class="line">	<span class="keyword">private</span> Integer marryId;</span><br><span class="line">    <span class="meta">@Column</span></span><br><span class="line">	<span class="keyword">private</span> String w_name;</span><br><span class="line">    <span class="meta">@Column</span></span><br><span class="line">	<span class="keyword">private</span> Integer w_age;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//表达一对一的关系</span></span><br><span class="line">    <span class="meta">@OneToOne</span></span><br><span class="line">    <span class="meta">@PrimaryKeyJoinColumn</span>  <span class="comment">//配置共享主键</span></span><br><span class="line">	<span class="keyword">private</span> Husband husband;</span><br><span class="line">	set/get...</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<h5 id="2-1-2-按照外键映射"><a href="#2-1-2-按照外键映射" class="headerlink" title="2.1.2 按照外键映射"></a>2.1.2 按照外键映射</h5><p>  Husband.java  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table</span>(name=<span class="string">"husband1"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Husband</span> </span>&#123;</span><br><span class="line">   <span class="meta">@Id</span></span><br><span class="line">   <span class="meta">@GeneratedValue</span>(strategy=GenerationType.IDENTITY)</span><br><span class="line">	<span class="keyword">private</span> Integer husband_id;</span><br><span class="line">   <span class="meta">@Column</span></span><br><span class="line">	<span class="keyword">private</span> String h_name;</span><br><span class="line">   <span class="meta">@Column</span></span><br><span class="line">	<span class="keyword">private</span> Integer h_age;</span><br><span class="line">    <span class="meta">@OneToOne</span><span class="comment">//表达一对一的关系</span></span><br><span class="line">    <span class="meta">@JoinColumn</span>(name=<span class="string">"wife_id001"</span>) <span class="comment">//新添加一个列作为外键去连接Wife表的主键</span></span><br><span class="line">	<span class="keyword">private</span> Wife wife;</span><br><span class="line">      set/get......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>​      Wife.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table</span>(name=<span class="string">"wife1"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Wife</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue</span>(strategy=GenerationType.IDENTITY)</span><br><span class="line">	<span class="keyword">private</span> Integer wife_id;</span><br><span class="line">    <span class="meta">@Column</span></span><br><span class="line">	<span class="keyword">private</span> String w_name;</span><br><span class="line">    <span class="meta">@Column</span></span><br><span class="line">	<span class="keyword">private</span> Integer w_age;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//表达一对一的关系</span></span><br><span class="line">    <span class="meta">@OneToOne</span>(mappedBy=<span class="string">"wife"</span>)  </span><br><span class="line">    <span class="comment">//mappedBy="wife"表示根据wife变量名查找对应类Wife类， </span></span><br><span class="line">    <span class="comment">//该wife类映射的表和Husband变量代表的Husband类映射的表有一对一的关系</span></span><br><span class="line">	<span class="keyword">private</span> Husband husband;</span><br><span class="line">    set/get.....</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-2-一对多-多对一"><a href="#2-2-一对多-多对一" class="headerlink" title="2.2 一对多|多对一"></a>2.2 一对多|多对一</h4><p>  Customer.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//主表</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table</span>(name=<span class="string">"customer"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Customer</span> </span>&#123;</span><br><span class="line">   <span class="meta">@Id</span></span><br><span class="line">   <span class="meta">@GeneratedValue</span>(strategy=GenerationType.IDENTITY)</span><br><span class="line">	<span class="keyword">private</span> Integer  cust_id;<span class="comment">//主键</span></span><br><span class="line">   <span class="meta">@Column</span></span><br><span class="line">	<span class="keyword">private</span> String  cust_name;</span><br><span class="line">   <span class="meta">@Column</span></span><br><span class="line">	<span class="keyword">private</span> Integer  cust_user_id;</span><br><span class="line">   <span class="meta">@Column</span></span><br><span class="line">	<span class="keyword">private</span> Integer  cust_create_id;</span><br><span class="line">   <span class="meta">@Column</span></span><br><span class="line">	<span class="keyword">private</span> String  cust_source;</span><br><span class="line">   <span class="meta">@Column</span></span><br><span class="line">	<span class="keyword">private</span> String  cust_industry;</span><br><span class="line">   <span class="meta">@Column</span></span><br><span class="line">	<span class="keyword">private</span> String  cust_level;</span><br><span class="line">   <span class="meta">@Column</span></span><br><span class="line">	<span class="keyword">private</span> String  cust_linkman;</span><br><span class="line">   <span class="meta">@Column</span></span><br><span class="line">	<span class="keyword">private</span> String  cust_phone;</span><br><span class="line">   <span class="meta">@Column</span></span><br><span class="line">	<span class="keyword">private</span> String  cust_mobile;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//表达一(Customer)对多(Contact)的关系  </span></span><br><span class="line">    <span class="comment">//cascade表示级联操作， 类型CascadeType(备注：javax.persistent.xxxxxx)</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 常见的</span></span><br><span class="line"><span class="comment">     * ALL:包含以下所有情况</span></span><br><span class="line"><span class="comment">     * REFRESH:级联刷新，当多个用户同时操作一个实体，为了用户取到的数据是实时的，</span></span><br><span class="line"><span class="comment">     *         在操作数据之前进行refresh().   </span></span><br><span class="line"><span class="comment">     * REMOVE:级联删除.删除当前表的数据会删除与之关联的表的数据。</span></span><br><span class="line"><span class="comment">     * MERGE:级联更新，更新当前表的数据与同时更新与之关联的表的数据。</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * 注解使用级联大多数看到是CascadeType.ALL, 严格来说CascadeType.MERGE</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@OneToMany</span>(mappedBy=<span class="string">"customer"</span>,cascade=CascadeType.ALL)</span><br><span class="line">	<span class="keyword">private</span> Set&lt;Contact&gt; contacts =<span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line">	set/get......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>​    Contact.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//从表(拥有外键。)</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table</span>(name=<span class="string">"contact"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Contact</span> </span>&#123;</span><br><span class="line"><span class="meta">@Id</span></span><br><span class="line"><span class="meta">@GeneratedValue</span>(strategy=GenerationType.IDENTITY)</span><br><span class="line"><span class="keyword">private</span> Integer contact_id; <span class="comment">//主键</span></span><br><span class="line"><span class="meta">@Column</span></span><br><span class="line"><span class="keyword">private</span> String contact_name;</span><br><span class="line"><span class="meta">@Transient</span>  <span class="comment">//表示该字段不会被映射到数据表中</span></span><br><span class="line"><span class="keyword">private</span> Integer contact_cust_id;<span class="comment">//外键(表达关系的时候声明外键即可)</span></span><br><span class="line"><span class="meta">@Column</span></span><br><span class="line"><span class="keyword">private</span> String contact_gender;</span><br><span class="line"><span class="meta">@Column</span></span><br><span class="line"><span class="keyword">private</span> String contact_phone;</span><br><span class="line"><span class="meta">@Column</span></span><br><span class="line"><span class="keyword">private</span> String contact_mobile;</span><br><span class="line"><span class="meta">@Column</span></span><br><span class="line"><span class="keyword">private</span> String contact_email;</span><br><span class="line"><span class="meta">@Column</span></span><br><span class="line"><span class="keyword">private</span> String contact_qq;</span><br><span class="line"><span class="meta">@Column</span></span><br><span class="line"><span class="keyword">private</span> String contact_position;</span><br><span class="line"><span class="meta">@Column</span></span><br><span class="line"><span class="keyword">private</span> String contact_memo;<span class="comment">//备注</span></span><br><span class="line"><span class="comment">//表达多(Contact)对一(Customer)关系</span></span><br><span class="line"><span class="meta">@ManyToOne</span></span><br><span class="line"><span class="meta">@JoinColumn</span>(name=<span class="string">"contact_cust_id"</span>) <span class="comment">//新添加一个列作为外键去连接Customer表</span></span><br><span class="line"><span class="keyword">private</span> Customer customer;</span><br><span class="line">set/get...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="测试："><a href="#测试：" class="headerlink" title="测试："></a>测试：</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test001</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		Session session = HibernateUtils.getCurrentSession();</span><br><span class="line">		Transaction transaction = session.beginTransaction();</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="comment">//保存客户的同时保存联系人</span></span><br><span class="line">			Customer customer =<span class="keyword">new</span> Customer();</span><br><span class="line">			customer.setCust_name(<span class="string">"马云33333"</span>);</span><br><span class="line">			</span><br><span class="line">			Contact contact1 =<span class="keyword">new</span> Contact();</span><br><span class="line">			contact1.setContact_name(<span class="string">"联系人333"</span>);</span><br><span class="line">			Contact contact2 =<span class="keyword">new</span> Contact();</span><br><span class="line">			contact2.setContact_name(<span class="string">"联系人444"</span>);</span><br><span class="line">			</span><br><span class="line">			<span class="comment">//表达关系</span></span><br><span class="line">			</span><br><span class="line">			<span class="comment">//一对多的关系</span></span><br><span class="line">			customer.getContacts().add(contact1);</span><br><span class="line">			customer.getContacts().add(contact2);</span><br><span class="line">			</span><br><span class="line">			<span class="comment">//多对一的关系</span></span><br><span class="line">			contact1.setCustomer(customer);</span><br><span class="line">			contact2.setCustomer(customer);</span><br><span class="line">			</span><br><span class="line">			<span class="comment">//持久化</span></span><br><span class="line">			<span class="comment">/*session.save(contact1);</span></span><br><span class="line"><span class="comment">			session.save(contact2);*/</span></span><br><span class="line">			session.save(customer);		</span><br><span class="line">			</span><br><span class="line">			transaction.commit();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			<span class="comment">// <span class="doctag">TODO:</span> handle exception</span></span><br><span class="line">			<span class="keyword">if</span> (transaction!=<span class="keyword">null</span>) &#123;</span><br><span class="line">				transaction.rollback();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-3-多对多"><a href="#2-3-多对多" class="headerlink" title="2.3 多对多"></a>2.3 多对多</h4><p>   前提条件：   只能一方维护中间表的关系，一方必须放弃维护</p>
<p>User.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table</span>(name=<span class="string">"user1"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue</span>(strategy=GenerationType.IDENTITY)</span><br><span class="line">	<span class="keyword">private</span> Integer user_id;</span><br><span class="line">    <span class="meta">@Column</span></span><br><span class="line">	<span class="keyword">private</span> String user_name;</span><br><span class="line">    <span class="meta">@Column</span></span><br><span class="line">	<span class="keyword">private</span> String user_pwd;</span><br><span class="line">    <span class="meta">@Column</span></span><br><span class="line">	<span class="keyword">private</span> String user_state;<span class="comment">//用户状态</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">//表达User和Role的多对多的关系(只是表达关系)</span></span><br><span class="line">    <span class="meta">@ManyToMany</span>(mappedBy=<span class="string">"users"</span>)</span><br><span class="line">	<span class="keyword">private</span> Set&lt;Role&gt; roles =<span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line">	set/get...</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>Role.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table</span>(name=<span class="string">"role"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Role</span> </span>&#123;</span><br><span class="line">     <span class="meta">@Id</span></span><br><span class="line">     <span class="meta">@GeneratedValue</span>(strategy=GenerationType.IDENTITY)</span><br><span class="line">	<span class="keyword">private</span> Integer role_id;<span class="comment">//角色编号</span></span><br><span class="line">    <span class="meta">@Column</span></span><br><span class="line">	<span class="keyword">private</span> String role_name;<span class="comment">//角色名</span></span><br><span class="line">    <span class="meta">@Column</span></span><br><span class="line">	<span class="keyword">private</span> String role_memo;<span class="comment">//角色备注</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">//表达Role和User的多对多的关系</span></span><br><span class="line">    <span class="meta">@ManyToMany</span></span><br><span class="line">    <span class="comment">// @JoinTable表示创建一个表。中间表。</span></span><br><span class="line">    <span class="comment">//name:中间表的名字</span></span><br><span class="line">    <span class="comment">//joinColumns:声明外键连接当前表Role</span></span><br><span class="line">    <span class="comment">//inverseJoinColumns:声明与当前表关联的表的主键对应的外键</span></span><br><span class="line">    <span class="meta">@JoinTable</span>(name=<span class="string">"user_role"</span>,</span><br><span class="line">               joinColumns=<span class="meta">@JoinColumn</span>(name=<span class="string">"role_id"</span>),</span><br><span class="line">               inverseJoinColumns=<span class="meta">@JoinColumn</span>(name=<span class="string">"user_id"</span>))</span><br><span class="line">	<span class="keyword">private</span> Set&lt;User&gt; users =<span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line">  set/get...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注解写表关系的时候：</p>
<p>   由外键声明连接表的时候(从表) 只需要表达关系不需要mappedBy</p>
<p>   mappedBy一般放在主表</p>
<p>一对一：one-to-one     外键声明：@joinColumn(name=”外键名”)</p>
<p>多对一|一对多： many-to-one   one-to-many  外键声明：@joinColumn(name=”外键名”)</p>
<p>对多多：many-to-many</p>
<p>  // @JoinTable表示创建一个表。中间表。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//name:中间表的名字</span></span><br><span class="line"><span class="comment">//joinColumns:声明外键连接当前表Role</span></span><br><span class="line"><span class="comment">//inverseJoinColumns:声明与当前表关联的表的主键对应的外键</span></span><br><span class="line"><span class="meta">@JoinTable</span>(name=<span class="string">"user_role"</span>,</span><br><span class="line">           joinColumns=<span class="meta">@JoinColumn</span>(name=<span class="string">"role_id"</span>),</span><br><span class="line">           inverseJoinColumns=<span class="meta">@JoinColumn</span>(name=<span class="string">"user_id"</span>))</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/11/27/Hibernate/" data-id="cjbcx65qw000088b1zcxvhwzz" class="article-share-link">Teilen</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2017/12/18/hello-world/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Neuer</strong>
      <div class="article-nav-title">
        
          Hello World
        
      </div>
    </a>
  
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archiv</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">letzter Beitrag</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2017/12/18/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="/2017/11/27/Hibernate/">(no title)</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>